<!DOCTYPE html>
<html>
<head>
<title>Spectrum ROM: Routine at 12A2</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Spectrum ROM" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="11B7.html">11B7</a></span></td>
<td class="up">Up: <a href="../maps/all.html#12A2">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="1391.html">1391</a></span></td>
</tr>
</table>
<div class="description">12A2: THE 'MAIN EXECUTION' LOOP</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="155D.html">MAIN_ADD</a>.
</div>
<div class="paragraph">
The main loop controls the 'editing mode', the execution of direct commands and the production of reports.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_EXEC</td>
<td class="address-2"><span id="12A2"></span>12A2</td>
<td class="instruction">LD (IY+$31),$02</td>
<td class="comment-11" rowspan="1">The lower part of the screen is to be two lines in size (see <a href="5C6B.html">DF-SZ</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12A6"></span>12A6</td>
<td class="instruction">CALL <a href="1795.html">AUTO_LIST</a></td>
<td class="comment-11" rowspan="1">Produce an automatic listing.</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="12A9"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="11B7.html">NEW</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_1</td>
<td class="address-2"><span id="12A9"></span>12A9</td>
<td class="instruction">CALL <a href="16B0.html">SET_MIN</a></td>
<td class="comment-11" rowspan="1">All the areas from <a href="5C59.html">E-LINE</a> onwards are given their minimum configurations.</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_2</td>
<td class="address-2"><span id="12AC"></span>12AC</td>
<td class="instruction">LD A,$00</td>
<td class="comment-11" rowspan="2">Channel 'K' is opened before calling the <a href="0F2C.html">EDITOR</a>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12AE"></span>12AE</td>
<td class="instruction">CALL <a href="1601.html">CHAN_OPEN</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12B1"></span>12B1</td>
<td class="instruction">CALL <a href="0F2C.html">EDITOR</a></td>
<td class="comment-11" rowspan="1">The <a href="0F2C.html">EDITOR</a> is called to allow the user to build up a BASIC line.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12B4"></span>12B4</td>
<td class="instruction">CALL <a href="1B17.html">LINE_SCAN</a></td>
<td class="comment-11" rowspan="1">The current line is scanned for correct syntax.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12B7"></span>12B7</td>
<td class="instruction">BIT 7,(IY+$00)</td>
<td class="comment-11" rowspan="2">Jump forward if the syntax is correct (<a href="5C3A.html">ERR-NR</a> is +FF).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12BB"></span>12BB</td>
<td class="instruction">JR NZ,<a href="12A2.html#12CF">MAIN_3</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12BD"></span>12BD</td>
<td class="instruction">BIT 4,(IY+$30)</td>
<td class="comment-11" rowspan="2">Jump forward if other than channel 'K' is being used (bit 4 of <a href="5C6A.html">FLAGS2</a> is set).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12C1"></span>12C1</td>
<td class="instruction">JR Z,<a href="12A2.html#1303">MAIN_4</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12C3"></span>12C3</td>
<td class="instruction">LD HL,($5C59)</td>
<td class="comment-11" rowspan="1">Point to the start of the line with the error (<a href="5C59.html">E-LINE</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12C6"></span>12C6</td>
<td class="instruction">CALL <a href="11A7.html">REMOVE_FP</a></td>
<td class="comment-11" rowspan="1">Remove the floating-point forms from this line.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12C9"></span>12C9</td>
<td class="instruction">LD (IY+$00),$FF</td>
<td class="comment-11" rowspan="2">Reset <a href="5C3A.html">ERR-NR</a> and jump back to <a href="12A2.html#12AC">MAIN_2</a> leaving the listing unchanged.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12CD"></span>12CD</td>
<td class="instruction">JR <a href="12A2.html#12AC">MAIN_2</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="12CF"></span>
<div class="comments">
<div class="paragraph">
The 'edit-line' has passed syntax and the three types of line that are possible have to be distinguished from each other.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_3</td>
<td class="address-2"><span id="12CF"></span>12CF</td>
<td class="instruction">LD HL,($5C59)</td>
<td class="comment-11" rowspan="1">Point to the start of the line (<a href="5C59.html">E-LINE</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12D2"></span>12D2</td>
<td class="instruction">LD ($5C5D),HL</td>
<td class="comment-11" rowspan="1">Set <a href="5C5D.html">CH-ADD</a> to the start also.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12D5"></span>12D5</td>
<td class="instruction">CALL <a href="19FB.html">E_LINE_NO</a></td>
<td class="comment-11" rowspan="1">Fetch any line number into <span class="register">BC</span>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12D8"></span>12D8</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="2">Is the line number a valid one?</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12D9"></span>12D9</td>
<td class="instruction">OR C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12DA"></span>12DA</td>
<td class="instruction">JP NZ,<a href="155D.html">MAIN_ADD</a></td>
<td class="comment-11" rowspan="1">Jump if it is so, and add the new line to the existing program.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12DD"></span>12DD</td>
<td class="instruction">RST <a href="0018.html">$18</a></td>
<td class="comment-11" rowspan="2">Fetch the first character of the line and see if the line is 'carriage return only'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12DE"></span>12DE</td>
<td class="instruction">CP $0D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12E0"></span>12E0</td>
<td class="instruction">JR Z,<a href="12A2.html#12A2">MAIN_EXEC</a></td>
<td class="comment-11" rowspan="1">If it is then jump back.</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="12E2"></span>
<div class="comments">
<div class="paragraph">
The 'edit-line' must start with a direct BASIC command so this line becomes the first line to be interpreted.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12E2"></span>12E2</td>
<td class="instruction">BIT 0,(IY+$30)</td>
<td class="comment-11" rowspan="2">Clear the whole display unless the flag (bit 0 of <a href="5C6A.html">FLAGS2</a>) says it is unnecessary.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12E6"></span>12E6</td>
<td class="instruction">CALL NZ,<a href="0DAF.html">CL_ALL</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12E9"></span>12E9</td>
<td class="instruction">CALL <a href="0D6B.html#0D6E">CLS_LOWER</a></td>
<td class="comment-11" rowspan="1">Clear the lower part anyway.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12EC"></span>12EC</td>
<td class="instruction">LD A,$19</td>
<td class="comment-11" rowspan="3">Set the appropriate value for the scroll counter (<a href="5C8C.html">SCR-CT</a>) by subtracting the second byte of <a href="5C88.html">S-POSN</a> from +19).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12EE"></span>12EE</td>
<td class="instruction">SUB (IY+$4F)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12F1"></span>12F1</td>
<td class="instruction">LD ($5C8C),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12F4"></span>12F4</td>
<td class="instruction">SET 7,(IY+$01)</td>
<td class="comment-11" rowspan="1">Signal 'line execution' (set bit 7 of <a href="5C3B.html">FLAGS</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12F8"></span>12F8</td>
<td class="instruction">LD (IY+$00),$FF</td>
<td class="comment-11" rowspan="1">Ensure <a href="5C3A.html">ERR-NR</a> is correct.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="12FC"></span>12FC</td>
<td class="instruction">LD (IY+$0A),$01</td>
<td class="comment-11" rowspan="1">Deal with the first statement in the line (set <a href="5C44.html">NSPPC</a> to +01).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1300"></span>1300</td>
<td class="instruction">CALL <a href="1B8A.html">LINE_RUN</a></td>
<td class="comment-11" rowspan="1">Now the line is interpreted. Note: the address <a href="12A2.html#1303">MAIN_4</a> goes on to the machine stack and is addressed by <a href="5C3D.html">ERR-SP</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="1303"></span>
<div class="comments">
<div class="paragraph">
After the line has been interpreted and all the actions consequential to it have been completed a return is made to <a href="12A2.html#1303">MAIN_4</a>, so that a report can be made.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_4</td>
<td class="address-2"><span id="1303"></span>1303</td>
<td class="instruction">HALT</td>
<td class="comment-11" rowspan="1">The maskable interrupt must be enabled.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1304"></span>1304</td>
<td class="instruction">RES 5,(IY+$01)</td>
<td class="comment-11" rowspan="1">Signal 'ready for a new key' (reset bit 5 of <a href="5C3B.html">FLAGS</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1308"></span>1308</td>
<td class="instruction">BIT 1,(IY+$30)</td>
<td class="comment-11" rowspan="2">Empty the printer buffer if it has been used (bit 1 of <a href="5C6A.html">FLAGS2</a> set).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="130C"></span>130C</td>
<td class="instruction">CALL NZ,<a href="0ECD.html">COPY_BUFF</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="130F"></span>130F</td>
<td class="instruction">LD A,($5C3A)</td>
<td class="comment-11" rowspan="2">Fetch the error number (<a href="5C3A.html">ERR-NR</a>) and increment it.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1312"></span>1312</td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="1313"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="1555.html">REPORT_G</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_G</td>
<td class="address-2"><span id="1313"></span>1313</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">Save the new value.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1314"></span>1314</td>
<td class="instruction">LD HL,$0000</td>
<td class="comment-11" rowspan="4">The system variables <a href="5C71.html">FLAGX</a>, <a href="5C5F.html">X-PTR-hi</a> and <a href="5C0B.html">DEFADD</a> are all set to zero.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1317"></span>1317</td>
<td class="instruction">LD (IY+$37),H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="131A"></span>131A</td>
<td class="instruction">LD (IY+$26),H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="131D"></span>131D</td>
<td class="instruction">LD ($5C0B),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1320"></span>1320</td>
<td class="instruction">LD HL,$0001</td>
<td class="comment-11" rowspan="2">Ensure that stream +00 points to channel 'K' (see <a href="5C10.html">STRMS</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1323"></span>1323</td>
<td class="instruction">LD ($5C16),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1326"></span>1326</td>
<td class="instruction">CALL <a href="16B0.html">SET_MIN</a></td>
<td class="comment-11" rowspan="1">Clear all the work areas and the calculator stack.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1329"></span>1329</td>
<td class="instruction">RES 5,(IY+$37)</td>
<td class="comment-11" rowspan="1">Signal 'editing mode' (reset bit 5 of <a href="5C71.html">FLAGX</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="132D"></span>132D</td>
<td class="instruction">CALL <a href="0D6B.html#0D6E">CLS_LOWER</a></td>
<td class="comment-11" rowspan="1">Clear the lower screen.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1330"></span>1330</td>
<td class="instruction">SET 5,(IY+$02)</td>
<td class="comment-11" rowspan="1">Signal 'the lower screen will require clearing' (set bit 5 of <a href="5C3C.html">TV-FLAG</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1334"></span>1334</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1">Fetch the report value.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1335"></span>1335</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">Make a copy in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1336"></span>1336</td>
<td class="instruction">CP $0A</td>
<td class="comment-11" rowspan="2">Jump forward with report numbers '0 to 9'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1338"></span>1338</td>
<td class="instruction">JR C,<a href="12A2.html#133C">MAIN_5</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="133A"></span>133A</td>
<td class="instruction">ADD A,$07</td>
<td class="comment-11" rowspan="1">Add the ASCII letter offset value.</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_5</td>
<td class="address-2"><span id="133C"></span>133C</td>
<td class="instruction">CALL <a href="15EF.html">OUT_CODE</a></td>
<td class="comment-11" rowspan="3">Print the report code and follow it with a 'space'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="133F"></span>133F</td>
<td class="instruction">LD A," "</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1341"></span>1341</td>
<td class="instruction">RST <a href="0010.html">$10</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1342"></span>1342</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1">Fetch the report value (used to identify the required report message).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1343"></span>1343</td>
<td class="instruction">LD DE,$1391</td>
<td class="comment-11" rowspan="2">Print the message.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1346"></span>1346</td>
<td class="instruction">CALL <a href="0C0A.html">PO_MSG</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1349"></span>1349</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="3">Follow it by a 'comma' and a 'space'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="134A"></span>134A</td>
<td class="instruction">LD DE,$1536</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="134D"></span>134D</td>
<td class="instruction">CALL <a href="0C0A.html">PO_MSG</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1350"></span>1350</td>
<td class="instruction">LD BC,($5C45)</td>
<td class="comment-11" rowspan="2">Now fetch the current line number (<a href="5C45.html">PPC</a>) and print it as well.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1354"></span>1354</td>
<td class="instruction">CALL <a href="1A1B.html">OUT_NUM_1</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1357"></span>1357</td>
<td class="instruction">LD A,":"</td>
<td class="comment-11" rowspan="2">Follow it by a ':'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1359"></span>1359</td>
<td class="instruction">RST <a href="0010.html">$10</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="135A"></span>135A</td>
<td class="instruction">LD C,(IY+$0D)</td>
<td class="comment-11" rowspan="3">Fetch the current statement number (<a href="5C47.html">SUBPPC</a>) into the <span class="register">BC</span> register pair and print it.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="135D"></span>135D</td>
<td class="instruction">LD B,$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="135F"></span>135F</td>
<td class="instruction">CALL <a href="1A1B.html">OUT_NUM_1</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1362"></span>1362</td>
<td class="instruction">CALL <a href="1097.html">CLEAR_SP</a></td>
<td class="comment-11" rowspan="1">Clear the editing area.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1365"></span>1365</td>
<td class="instruction">LD A,($5C3A)</td>
<td class="comment-11" rowspan="1">Fetch the error number (<a href="5C3A.html">ERR-NR</a>) again.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1368"></span>1368</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">Increment it as usual.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1369"></span>1369</td>
<td class="instruction">JR Z,<a href="12A2.html#1386">MAIN_9</a></td>
<td class="comment-11" rowspan="1">If the program was completed successfully there cannot be any 'CONTinuing' so jump.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="136B"></span>136B</td>
<td class="instruction">CP $09</td>
<td class="comment-11" rowspan="5">If the program halted with 'STOP statement' or 'BREAK into program' CONTinuing will be from the next statement; otherwise <a href="5C47.html">SUBPPC</a> is unchanged.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="136D"></span>136D</td>
<td class="instruction">JR Z,<a href="12A2.html#1373">MAIN_6</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="136F"></span>136F</td>
<td class="instruction">CP $15</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1371"></span>1371</td>
<td class="instruction">JR NZ,<a href="12A2.html#1376">MAIN_7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1">MAIN_6</td>
<td class="address-2"><span id="1373"></span>1373</td>
<td class="instruction">INC (IY+$0D)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1">MAIN_7</td>
<td class="address-2"><span id="1376"></span>1376</td>
<td class="instruction">LD BC,$0003</td>
<td class="comment-11" rowspan="2">The system variables <a href="5C6E.html">OLDPPC</a> and <a href="5C70.html">OSPCC</a> have now to be made to hold the CONTinuing line and statement numbers.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1379"></span>1379</td>
<td class="instruction">LD DE,$5C70</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="137C"></span>137C</td>
<td class="instruction">LD HL,$5C44</td>
<td class="comment-11" rowspan="5">The values used will be those in <a href="5C45.html">PPC</a> and <a href="5C47.html">SUBPPC</a> unless <a href="5C44.html">NSPPC</a> indicates that the 'break' occurred before a 'jump' (i.e. after a GO TO statement etc.).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="137F"></span>137F</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1381"></span>1381</td>
<td class="instruction">JR Z,<a href="12A2.html#1384">MAIN_8</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="1383"></span>1383</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1">MAIN_8</td>
<td class="address-2"><span id="1384"></span>1384</td>
<td class="instruction">LDDR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1">MAIN_9</td>
<td class="address-2"><span id="1386"></span>1386</td>
<td class="instruction">LD (IY+$0A),$FF</td>
<td class="comment-11" rowspan="1"><a href="5C44.html">NSPPC</a> is reset to indicate 'no jump'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="138A"></span>138A</td>
<td class="instruction">RES 3,(IY+$01)</td>
<td class="comment-11" rowspan="1">'K mode' is selected (reset bit 3 of <a href="5C3B.html">FLAGS</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="138E"></span>138E</td>
<td class="instruction">JP <a href="12A2.html#12AC">MAIN_2</a></td>
<td class="comment-11" rowspan="1">And finally the jump back is made but no program listing will appear until requested.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="11B7.html">11B7</a></span></td>
<td class="up">Up: <a href="../maps/all.html#12A2">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="1391.html">1391</a></span></td>
</tr>
</table>
<footer>
<div class="release">The Complete Spectrum ROM Disassembly 20180102</div>
<div class="copyright">&#169; 1982 Amstrad. &#169; 1983 Dr Ian Logan &amp; Dr Frank O'Hara. &#169; 2018 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 6.2.</div>
</footer>
</body>
</html>