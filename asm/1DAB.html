<!DOCTYPE html>
<html>
<head>
<title>Spectrum ROM: Routine at 1DAB</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Spectrum ROM" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="1D86.html">1D86</a>
</td>
<td class="up">Up: <a href="../maps/all.html#1DAB">Map</a></td>
<td class="next">
Next: <a href="1DDA.html">1DDA</a>
</td>
</tr>
</table>
<div class="description">1DAB: THE 'NEXT' COMMAND ROUTINE</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
The address of this routine is found in the <a href="1A48.html#1A98">parameter table</a>.
</div>
<div class="paragraph">
The 'variable in assignment' has already been determined (see <a href="1C6C.html">CLASS_04</a>), and it remains to change the VALUE as required.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">NEXT</td>
<td class="address-2"><span id="1DAB"></span>1DAB</td>
<td class="instruction">BIT 1,(IY+$37)</td>
<td class="comment-1" rowspan="2">Jump to give the error report if the variable was not found (bit 1 of <a href="5C71.html">FLAGX</a> set).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DAF"></span>1DAF</td>
<td class="instruction">JP NZ,<a href="1C22.html#1C2E">REPORT_2</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DB2"></span>1DB2</td>
<td class="instruction">LD HL,($5C4D)</td>
<td class="comment-1" rowspan="3">The address of the variable is fetched from <a href="5C4D.html">DEST</a> and the name tested further.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DB5"></span>1DB5</td>
<td class="instruction">BIT 7,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DB7"></span>1DB7</td>
<td class="instruction">JR Z,<a href="1DAB.html#1DD8">REPORT_1</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="1DB9"></span>
<div class="comments">
<div class="paragraph">
Next the variable's VALUE (v) and STEP (s) are manipulated by the calculator.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DB9"></span>1DB9</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Step past the name.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DBA"></span>1DBA</td>
<td class="instruction">LD ($5C68),HL</td>
<td class="comment-1" rowspan="1">Make the variable a temporary 'memory area' by setting <a href="5C68.html">MEM</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DBD"></span>1DBD</td>
<td class="instruction">RST <a href="0028.html">$28</a></td>
<td class="comment-1" rowspan="1">-</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DBE"></span>1DBE</td>
<td class="instruction">DEFB $E0</td>
<td class="comment-1" rowspan="1"><a href="340F.html">get_mem_0</a>: v</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DBF"></span>1DBF</td>
<td class="instruction">DEFB $E2</td>
<td class="comment-1" rowspan="1"><a href="340F.html">get_mem_2</a>: v, s</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DC0"></span>1DC0</td>
<td class="instruction">DEFB $0F</td>
<td class="comment-1" rowspan="1"><a href="3014.html">addition</a>: v+s</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DC1"></span>1DC1</td>
<td class="instruction">DEFB $C0</td>
<td class="comment-1" rowspan="1"><a href="342D.html">st_mem_0</a>: v+s (v is replaced by v+s in mem-0)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DC2"></span>1DC2</td>
<td class="instruction">DEFB $02</td>
<td class="comment-1" rowspan="1"><a href="335B.html#33A1">delete</a>: -</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DC3"></span>1DC3</td>
<td class="instruction">DEFB $38</td>
<td class="comment-1" rowspan="1"><a href="369B.html">end_calc</a>: -</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="1DC4"></span>
<div class="comments">
<div class="paragraph">
The result of adding the VALUE and the STEP is now tested against the LIMIT by calling <a href="1DDA.html">NEXT_LOOP</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DC4"></span>1DC4</td>
<td class="instruction">CALL <a href="1DDA.html">NEXT_LOOP</a></td>
<td class="comment-1" rowspan="1">Test the new VALUE against the LIMIT.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DC7"></span>1DC7</td>
<td class="instruction">RET C</td>
<td class="comment-1" rowspan="1">Return now if the FOR-NEXT loop has been completed.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="1DC8"></span>
<div class="comments">
<div class="paragraph">
Otherwise collect the 'looping' line number and statement.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DC8"></span>1DC8</td>
<td class="instruction">LD HL,($5C68)</td>
<td class="comment-1" rowspan="3">Find the address of the low byte of the looping line number (<a href="5C68.html">MEM</a>+0F).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DCB"></span>1DCB</td>
<td class="instruction">LD DE,$000F</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DCE"></span>1DCE</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DCF"></span>1DCF</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="4">Now fetch this line number.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DD0"></span>1DD0</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DD1"></span>1DD1</td>
<td class="instruction">LD D,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DD2"></span>1DD2</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DD3"></span>1DD3</td>
<td class="instruction">LD H,(HL)</td>
<td class="comment-1" rowspan="1">Followed by the statement number.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DD4"></span>1DD4</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="2">Exchange the numbers before jumping forward to treat them as the destination line of a GO TO command.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DD5"></span>1DD5</td>
<td class="instruction">JP <a href="1E67.html#1E73">GO_TO_2</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="1DD8"></span>
<div class="comments">
<div class="paragraph">
Report 1 - NEXT without FOR.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">REPORT_1</td>
<td class="address-2"><span id="1DD8"></span>1DD8</td>
<td class="instruction">RST <a href="0008.html">$08</a></td>
<td class="comment-1" rowspan="2">Call the error handling routine.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="1DD9"></span>1DD9</td>
<td class="instruction">DEFB $00</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="1D86.html">1D86</a>
</td>
<td class="up">Up: <a href="../maps/all.html#1DAB">Map</a></td>
<td class="next">
Next: <a href="1DDA.html">1DDA</a>
</td>
</tr>
</table>
<footer>
<div class="release">The Complete Spectrum ROM Disassembly 20200807</div>
<div class="copyright">&#169; 1982 Amstrad. &#169; 1983 Dr Ian Logan &amp; Dr Frank O'Hara. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../dec/asm/7595.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>