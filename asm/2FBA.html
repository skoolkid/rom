<!DOCTYPE html>
<html>
<head>
<title>Spectrum ROM: Routine at 2FBA</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Spectrum ROM" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="2F9B.html">2F9B</a>
</td>
<td class="up">Up: <a href="../maps/all.html#2FBA">Map</a></td>
<td class="next">
Next: <a href="2FDD.html">2FDD</a>
</td>
</tr>
</table>
<div class="description">2FBA: THE 'FETCH TWO NUMBERS' SUBROUTINE</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="2DE3.html">PRINT_FP</a>, <a href="3014.html">addition</a>, <a href="30CA.html">multiply</a> and <a href="31AF.html">division</a>.
</div>
<div class="paragraph">
This subroutine is called by <a href="3014.html">addition</a>, <a href="30CA.html">multiply</a> and <a href="31AF.html">division</a> to get two numbers from the calculator stack and put them into the registers, including the exchange registers.
</div>
<div class="paragraph">
On entry to the subroutine the <span class="register">HL</span> register pair points to the first byte of the first number (M) and the <span class="register">DE</span> register pair points to the first byte of the second number (N).
</div>
<div class="paragraph">
When the subroutine is called from <a href="30CA.html">multiply</a> or <a href="31AF.html">division</a> the sign of the result is saved in the second byte of the first number.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Bit 7 holds the sign bit of the result (when called from <a href="30CA.html">multiply</a> or <a href="31AF.html">division</a>)</td>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Address of the first byte of N</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address of the first byte of M</td>
</tr>
</table>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">H'B'C'CB</td>
<td class="register-desc">The five bytes of M</td>
</tr>
<tr>
<td class="register">L'D'E'DE</td>
<td class="register-desc">The five bytes of N</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">FETCH_TWO</td>
<td class="address-2"><span id="2FBA"></span>2FBA</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span> is preserved.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FBB"></span>2FBB</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1"><span class="register">AF</span> is preserved.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="2FBC"></span>
<div class="comments">
<div class="paragraph">
Call the five bytes of the first number M1, M2, M3, M4 and M5, and the five bytes of the second number N1, N2, N3, N4 and N5.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FBC"></span>2FBC</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1">M1 to <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FBD"></span>2FBD</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FBE"></span>2FBE</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-1" rowspan="1">M2 to <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FBF"></span>2FBF</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Copy the sign of the result to bit 7 of (<span class="register">HL</span>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FC0"></span>2FC0</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FC1"></span>2FC1</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1">M1 to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FC2"></span>2FC2</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1">M3 to <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FC3"></span>2FC3</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Save M2 and M3 on the machine stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FC4"></span>2FC4</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FC5"></span>2FC5</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1">M4 to <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FC6"></span>2FC6</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FC7"></span>2FC7</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-1" rowspan="1">M5 to <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FC8"></span>2FC8</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span> now points to N1.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FC9"></span>2FC9</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="1">M1 to <span class="register">D</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FCA"></span>2FCA</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="1">N1 to <span class="register">E</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FCB"></span>2FCB</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Save M1 and N1 on the machine stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FCC"></span>2FCC</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FCD"></span>2FCD</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-1" rowspan="1">N2 to <span class="register">D</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FCE"></span>2FCE</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FCF"></span>2FCF</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="1">N3 to <span class="register">E</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FD0"></span>2FD0</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Save N2 and N3 on the machine stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FD1"></span>2FD1</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1">Get the exchange registers.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FD2"></span>2FD2</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">N2 to <span class="register">D'</span> and N3 to <span class="register">E'</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FD3"></span>2FD3</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">M1 to <span class="register">H'</span> and N1 to <span class="register">L'</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FD4"></span>2FD4</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">M2 to <span class="register">B'</span> and M3 to <span class="register">C'</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FD5"></span>2FD5</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1">Get the original set of registers.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FD6"></span>2FD6</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FD7"></span>2FD7</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-1" rowspan="1">N4 to <span class="register">D</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FD8"></span>2FD8</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FD9"></span>2FD9</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="1">N5 to <span class="register">E</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FDA"></span>2FDA</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore the original <span class="register">AF</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FDB"></span>2FDB</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the original <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2FDC"></span>2FDC</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Finished.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<div class="comments">
<div class="paragraph">
Summary:
</div>
<div class="paragraph">
<ul class="">
<li>M1 - M5 are in <span class="register">H'</span>, <span class="register">B'</span>, <span class="register">C'</span>, <span class="register">C</span>, <span class="register">B</span>.</li>
<li>N1 - N5 are in <span class="register">L'</span>, <span class="register">D'</span>, <span class="register">E'</span>, <span class="register">D</span>, <span class="register">E</span>.</li>
<li><span class="register">HL</span> points to the first byte of the first number.</li>
</ul>
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="2F9B.html">2F9B</a>
</td>
<td class="up">Up: <a href="../maps/all.html#2FBA">Map</a></td>
<td class="next">
Next: <a href="2FDD.html">2FDD</a>
</td>
</tr>
</table>
<footer>
<div class="release">The Complete Spectrum ROM Disassembly 20200807</div>
<div class="copyright">&#169; 1982 Amstrad. &#169; 1983 Dr Ian Logan &amp; Dr Frank O'Hara. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../dec/asm/12218.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>