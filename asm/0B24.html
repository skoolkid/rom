<!DOCTYPE html>
<html>
<head>
<title>Spectrum ROM: Routine at 0B24</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Spectrum ROM" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="0B03.html">0B03</a></span></td>
<td class="up">Up: <a href="../maps/all.html#0B24">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="0BDB.html">0BDB</a></span></td>
</tr>
</table>
<div class="description">0B24: THE 'PRINT ANY CHARACTER(S)' SUBROUTINE</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="0AD9.html">PO_ABLE</a>.
</div>
<div class="paragraph">
Ordinary character codes, token codes and user-defined graphic codes, and graphic codes are dealt with separately.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Character code</td>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Line number</td>
</tr>
<tr>
<td class="register">C</td>
<td class="register-desc">Column number</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Display file address or printer buffer address</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-1">PO_ANY</td>
<td class="address-2"><span id="0B24"></span>0B24</td>
<td class="instruction">CP $80</td>
<td class="comment-11" rowspan="2">Jump forward with ordinary character codes.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B26"></span>0B26</td>
<td class="instruction">JR C,<a href="0B24.html#0B65">PO_CHAR</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B28"></span>0B28</td>
<td class="instruction">CP $90</td>
<td class="comment-11" rowspan="2">Jump forward with token codes and UDG codes.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B2A"></span>0B2A</td>
<td class="instruction">JR NC,<a href="0B24.html#0B52">PO_T_UDG</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B2C"></span>0B2C</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">Move the graphic code.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B2D"></span>0B2D</td>
<td class="instruction">CALL <a href="0B24.html#0B38">PO_GR_1</a></td>
<td class="comment-11" rowspan="1">Construct the graphic form.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B30"></span>0B30</td>
<td class="instruction">CALL <a href="0B03.html">PO_FETCH</a></td>
<td class="comment-11" rowspan="1"><span class="register">HL</span> has been disturbed so 'fetch' again.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B33"></span>0B33</td>
<td class="instruction">LD DE,$5C92</td>
<td class="comment-11" rowspan="1">Make <span class="register">DE</span> point to the start of the graphic form, i.e. <a href="5C92.html">MEMBOT</a>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B36"></span>0B36</td>
<td class="instruction">JR <a href="0B24.html#0B7F">PR_ALL</a></td>
<td class="comment-11" rowspan="1">Jump forward to print the graphic character.</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="0B38"></span>
<div class="comments">
<div class="paragraph">
Graphic characters are constructed in an ad hoc manner in the calculator's memory area, i.e. mem-0 and mem-1.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">PO_GR_1</td>
<td class="address-2"><span id="0B38"></span>0B38</td>
<td class="instruction">LD HL,$5C92</td>
<td class="comment-11" rowspan="1">This is <a href="5C92.html">MEMBOT</a>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B3B"></span>0B3B</td>
<td class="instruction">CALL <a href="0B24.html#0B3E">PO_GR_2</a></td>
<td class="comment-11" rowspan="1">In effect call the following subroutine twice.</td>
</tr>
<tr>
<td class="asm-label-1">PO_GR_2</td>
<td class="address-2"><span id="0B3E"></span>0B3E</td>
<td class="instruction">RR B</td>
<td class="comment-11" rowspan="2">Determine bit 0 (and later bit 2) of the graphic code.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B40"></span>0B40</td>
<td class="instruction">SBC A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B41"></span>0B41</td>
<td class="instruction">AND $0F</td>
<td class="comment-11" rowspan="1">The <span class="register">A</span> register will hold +00 or +0F depending on the value of the bit in the code.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B43"></span>0B43</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">Save the result in <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B44"></span>0B44</td>
<td class="instruction">RR B</td>
<td class="comment-11" rowspan="2">Determine bit 1 (and later bit 3) of the graphic code.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B46"></span>0B46</td>
<td class="instruction">SBC A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B47"></span>0B47</td>
<td class="instruction">AND $F0</td>
<td class="comment-11" rowspan="1">The <span class="register">A</span> register will hold +00 or +F0.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B49"></span>0B49</td>
<td class="instruction">OR C</td>
<td class="comment-11" rowspan="1">The two results are combined.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B4A"></span>0B4A</td>
<td class="instruction">LD C,$04</td>
<td class="comment-11" rowspan="6">The <span class="register">A</span> register holds half the character form and has to be used four times. This is done for the upper half of the character form and then the lower.</td>
</tr>
<tr>
<td class="asm-label-1">PO_GR_3</td>
<td class="address-2"><span id="0B4C"></span>0B4C</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B4D"></span>0B4D</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B4E"></span>0B4E</td>
<td class="instruction">DEC C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B4F"></span>0B4F</td>
<td class="instruction">JR NZ,<a href="0B24.html#0B4C">PO_GR_3</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B51"></span>0B51</td>
<td class="instruction">RET</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="0B52"></span>
<div class="comments">
<div class="paragraph">
Token codes and user-defined graphic codes are now separated.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">PO_T_UDG</td>
<td class="address-2"><span id="0B52"></span>0B52</td>
<td class="instruction">SUB $A5</td>
<td class="comment-11" rowspan="2">Jump forward with token codes.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B54"></span>0B54</td>
<td class="instruction">JR NC,<a href="0B24.html#0B5F">PO_T</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B56"></span>0B56</td>
<td class="instruction">ADD A,$15</td>
<td class="comment-11" rowspan="1">UDG codes are now +00 to +0F.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B58"></span>0B58</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Save the current position values on the machine stack.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B59"></span>0B59</td>
<td class="instruction">LD BC,($5C7B)</td>
<td class="comment-11" rowspan="2">Fetch the base address of the UDG area (from <a href="5C7B.html">UDG</a>) and jump forward.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B5D"></span>0B5D</td>
<td class="instruction">JR <a href="0B24.html#0B6A">PO_CHAR_2</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1">PO_T</td>
<td class="address-2"><span id="0B5F"></span>0B5F</td>
<td class="instruction">CALL <a href="0C0A.html#0C10">PO_TOKENS</a></td>
<td class="comment-11" rowspan="2">Now print the token and return via <a href="0B03.html">PO_FETCH</a>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B62"></span>0B62</td>
<td class="instruction">JP <a href="0B03.html">PO_FETCH</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="0B65"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="0A3D.html">PO_RIGHT</a>.
</div>
<div class="paragraph">
The required character form is identified.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">PO_CHAR</td>
<td class="address-2"><span id="0B65"></span>0B65</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">The current position is saved.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B66"></span>0B66</td>
<td class="instruction">LD BC,($5C36)</td>
<td class="comment-11" rowspan="1">The base address of the character area is fetched (<a href="5C36.html">CHARS</a>).</td>
</tr>
<tr>
<td class="asm-label-1">PO_CHAR_2</td>
<td class="address-2"><span id="0B6A"></span>0B6A</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">The print address is saved.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B6B"></span>0B6B</td>
<td class="instruction">LD HL,$5C3B</td>
<td class="comment-11" rowspan="1">This is <a href="5C3B.html">FLAGS</a>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B6E"></span>0B6E</td>
<td class="instruction">RES 0,(HL)</td>
<td class="comment-11" rowspan="1">Allow for a leading space.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B70"></span>0B70</td>
<td class="instruction">CP " "</td>
<td class="comment-11" rowspan="2">Jump forward if the character is not a 'space'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B72"></span>0B72</td>
<td class="instruction">JR NZ,<a href="0B24.html#0B76">PO_CHAR_3</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B74"></span>0B74</td>
<td class="instruction">SET 0,(HL)</td>
<td class="comment-11" rowspan="1">But 'suppress' if it is.</td>
</tr>
<tr>
<td class="asm-label-1">PO_CHAR_3</td>
<td class="address-2"><span id="0B76"></span>0B76</td>
<td class="instruction">LD H,$00</td>
<td class="comment-11" rowspan="2">Now pass the character code to the <span class="register">HL</span> register pair.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B78"></span>0B78</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B79"></span>0B79</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-11" rowspan="3">The character code is in effect multiplied by 8.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B7A"></span>0B7A</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B7B"></span>0B7B</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B7C"></span>0B7C</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">The base address of the character form is found.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B7D"></span>0B7D</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="2">The current position is fetched and the base address passed to the <span class="register">DE</span> register pair.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B7E"></span>0B7E</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="0B7F"></span>
<div class="comments">
<div class="paragraph">
The following subroutine is used to print all '8*8' bit characters. On entry the <span class="register">DE</span> register pair holds the base address of the character form, the <span class="register">HL</span> register the destination address and the <span class="register">BC</span> register pair the current 'line and column' values.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">PR_ALL</td>
<td class="address-2"><span id="0B7F"></span>0B7F</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="1">Fetch the column number.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B80"></span>0B80</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1">Move one column rightwards.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B81"></span>0B81</td>
<td class="instruction">LD A,$21</td>
<td class="comment-11" rowspan="2">Jump forward unless a new line is indicated.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B83"></span>0B83</td>
<td class="instruction">JR NZ,<a href="0B24.html#0B93">PR_ALL_1</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B85"></span>0B85</td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="1">Move down one line.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B86"></span>0B86</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">Column number is +21.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B87"></span>0B87</td>
<td class="instruction">BIT 1,(IY+$01)</td>
<td class="comment-11" rowspan="2">Jump forward if handling the screen (bit 1 of <a href="5C3B.html">FLAGS</a> reset).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B8B"></span>0B8B</td>
<td class="instruction">JR Z,<a href="0B24.html#0B93">PR_ALL_1</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B8D"></span>0B8D</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="3">Save the base address whilst the printer buffer is emptied.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B8E"></span>0B8E</td>
<td class="instruction">CALL <a href="0ECD.html">COPY_BUFF</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B91"></span>0B91</td>
<td class="instruction">POP DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B92"></span>0B92</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="1">Copy the new column number.</td>
</tr>
<tr>
<td class="asm-label-1">PR_ALL_1</td>
<td class="address-2"><span id="0B93"></span>0B93</td>
<td class="instruction">CP C</td>
<td class="comment-11" rowspan="4">Test whether a new line is being used. If it is see if the display requires to be scrolled.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B94"></span>0B94</td>
<td class="instruction">PUSH DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B95"></span>0B95</td>
<td class="instruction">CALL Z,<a href="0C55.html">PO_SCR</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B98"></span>0B98</td>
<td class="instruction">POP DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="0B99"></span>
<div class="comments">
<div class="paragraph">
Now consider the present state of INVERSE and OVER.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B99"></span>0B99</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="2">Save the position values and the destination address on the machine stack.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B9A"></span>0B9A</td>
<td class="instruction">PUSH HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B9B"></span>0B9B</td>
<td class="instruction">LD A,($5C91)</td>
<td class="comment-11" rowspan="1">Fetch <a href="5C91.html">P-FLAG</a> and read bit 0.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0B9E"></span>0B9E</td>
<td class="instruction">LD B,$FF</td>
<td class="comment-11" rowspan="4">Prepare the 'OVER mask' in the <span class="register">B</span> register, i.e. OVER 0=+00 and OVER 1=+FF.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BA0"></span>0BA0</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BA1"></span>0BA1</td>
<td class="instruction">JR C,<a href="0B24.html#0BA4">PR_ALL_2</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BA3"></span>0BA3</td>
<td class="instruction">INC B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1">PR_ALL_2</td>
<td class="address-2"><span id="0BA4"></span>0BA4</td>
<td class="instruction">RRA</td>
<td class="comment-11" rowspan="4">Read bit 2 of <a href="5C91.html">P-FLAG</a> and prepare the 'INVERSE mask' in the <span class="register">C</span> register, i.e. INVERSE 0=+00 and INVERSE 1=+FF.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BA5"></span>0BA5</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BA6"></span>0BA6</td>
<td class="instruction">SBC A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BA7"></span>0BA7</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BA8"></span>0BA8</td>
<td class="instruction">LD A,$08</td>
<td class="comment-11" rowspan="2">Set the <span class="register">A</span> register to hold the 'pixel-line' counter and clear the carry flag.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BAA"></span>0BAA</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BAB"></span>0BAB</td>
<td class="instruction">BIT 1,(IY+$01)</td>
<td class="comment-11" rowspan="2">Jump forward if handling the screen (bit 1 of <a href="5C3B.html">FLAGS</a> reset).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BAF"></span>0BAF</td>
<td class="instruction">JR Z,<a href="0B24.html#0BB6">PR_ALL_3</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BB1"></span>0BB1</td>
<td class="instruction">SET 1,(IY+$30)</td>
<td class="comment-11" rowspan="1">Signal 'printer buffer no longer empty' (set bit 1 of <a href="5C6A.html">FLAGS2</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BB5"></span>0BB5</td>
<td class="instruction">SCF</td>
<td class="comment-11" rowspan="1">Set the carry flag to show that the printer is being used.</td>
</tr>
<tr>
<td class="asm-label-1">PR_ALL_3</td>
<td class="address-2"><span id="0BB6"></span>0BB6</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Exchange the destination address with the base address before entering the loop.</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="0BB7"></span>
<div class="comments">
<div class="paragraph">
The character can now be printed. Eight passes of the loop are made - one for each 'pixel-line'.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">PR_ALL_4</td>
<td class="address-2"><span id="0BB7"></span>0BB7</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">The carry flag is set when using the printer. Save this flag in <span class="register">F'</span>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BB8"></span>0BB8</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Fetch the existing 'pixel-line'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BB9"></span>0BB9</td>
<td class="instruction">AND B</td>
<td class="comment-11" rowspan="2">Use the 'OVER mask' and then 'XOR' the result with the 'pixel-line' of the character form.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BBA"></span>0BBA</td>
<td class="instruction">XOR (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BBB"></span>0BBB</td>
<td class="instruction">XOR C</td>
<td class="comment-11" rowspan="1">Finally consider the 'INVERSE mask'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BBC"></span>0BBC</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Enter the result.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BBD"></span>0BBD</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="2">Fetch the printer flag and jump forward if required.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BBE"></span>0BBE</td>
<td class="instruction">JR C,<a href="0B24.html#0BD3">PR_ALL_6</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BC0"></span>0BC0</td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1">Update the destination address.</td>
</tr>
<tr>
<td class="asm-label-1">PR_ALL_5</td>
<td class="address-2"><span id="0BC1"></span>0BC1</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Update the 'pixel-line' address of the character form.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BC2"></span>0BC2</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="2">Decrease the counter and loop back unless it is zero.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BC3"></span>0BC3</td>
<td class="instruction">JR NZ,<a href="0B24.html#0BB7">PR_ALL_4</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="0BC5"></span>
<div class="comments">
<div class="paragraph">
Once the character has been printed the attribute byte is to be set as required.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BC5"></span>0BC5</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="2">Make the <span class="register">H</span> register hold a correct high-address for the character area.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BC6"></span>0BC6</td>
<td class="instruction">DEC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BC7"></span>0BC7</td>
<td class="instruction">BIT 1,(IY+$01)</td>
<td class="comment-11" rowspan="2">Set the attribute byte only if handling the screen (bit 1 of <a href="5C3B.html">FLAGS</a> reset).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BCB"></span>0BCB</td>
<td class="instruction">CALL Z,<a href="0BDB.html">PO_ATTR</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BCE"></span>0BCE</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="2">Restore the original destination address and the position values.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BCF"></span>0BCF</td>
<td class="instruction">POP BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BD0"></span>0BD0</td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="3">Decrease the column number and increase the destination address before returning.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BD1"></span>0BD1</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BD2"></span>0BD2</td>
<td class="instruction">RET</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="0BD3"></span>
<div class="comments">
<div class="paragraph">
When the printer is being used the destination address has to be updated in increments of +20.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">PR_ALL_6</td>
<td class="address-2"><span id="0BD3"></span>0BD3</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">Save the printer flag again.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BD4"></span>0BD4</td>
<td class="instruction">LD A,$20</td>
<td class="comment-11" rowspan="1">The required increment value.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BD6"></span>0BD6</td>
<td class="instruction">ADD A,E</td>
<td class="comment-11" rowspan="2">Add the value and pass the result back to the <span class="register">E</span> register.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BD7"></span>0BD7</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BD8"></span>0BD8</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1">Fetch the flag.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="0BD9"></span>0BD9</td>
<td class="instruction">JR <a href="0B24.html#0BC1">PR_ALL_5</a></td>
<td class="comment-11" rowspan="1">Jump back into the loop.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="0B03.html">0B03</a></span></td>
<td class="up">Up: <a href="../maps/all.html#0B24">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="0BDB.html">0BDB</a></span></td>
</tr>
</table>
<footer>
<div class="release">The Complete Spectrum ROM Disassembly 20180102</div>
<div class="copyright">&#169; 1982 Amstrad. &#169; 1983 Dr Ian Logan &amp; Dr Frank O'Hara. &#169; 2018 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 6.2.</div>
</footer>
</body>
</html>