<!DOCTYPE html>
<html>
<head>
<title>Spectrum ROM: Routine at 247D</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Spectrum ROM" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="2382.html">2382</a>
</td>
<td class="up">Up: <a href="../maps/all.html#247D">Map</a></td>
<td class="next">
Next: <a href="24B7.html">24B7</a>
</td>
</tr>
</table>
<div class="description">247D: THE 'INITIAL PARAMETERS' SUBROUTINE</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This subroutine is called by both <a href="2320.html">CIRCLE</a> and <a href="2382.html">DRAW</a> to set their initial parameters. It is called by <a href="2320.html">CIRCLE</a> with X, Y and the radius Z on the top of the stack, reading upwards. It is called by <a href="2382.html">DRAW</a> with its own X, Y, SIN (G/2) and Z, as defined in <a href="2382.html">DRAW</a> i., on the top of the stack. In what follows the stack is only shown from Z upwards.
</div>
<div class="paragraph">
The subroutine returns in <span class="register">B</span> the arc-count A as explained in both <a href="2320.html">CIRCLE</a> and <a href="2382.html">DRAW</a>, and in mem-0 to mem-5 the quantities G/A, SIN (G/2*A), 0, COS (G/A), SIN (G/A) and G. For a circle, G must be taken to be equal to 2&#960;.
</div>
</div>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Arc count</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">CD_PRMS1</td>
<td class="address-2"><span id="247D"></span>247D</td>
<td class="instruction">RST <a href="0028.html">$28</a></td>
<td class="comment-1" rowspan="1">Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="247E"></span>247E</td>
<td class="instruction">DEFB $31</td>
<td class="comment-1" rowspan="1"><a href="33C0.html">duplicate</a>: Z, Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="247F"></span>247F</td>
<td class="instruction">DEFB $28</td>
<td class="comment-1" rowspan="1"><a href="384A.html">sqr</a>: Z, SQR Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2480"></span>2480</td>
<td class="instruction">DEFB $34</td>
<td class="comment-1" rowspan="2"><a href="33C6.html">stk_data</a>: Z, SQR Z, 2</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2481"></span>2481</td>
<td class="instruction">DEFB $32,$00</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2483"></span>2483</td>
<td class="instruction">DEFB $01</td>
<td class="comment-1" rowspan="1"><a href="343C.html">exchange</a>: Z, 2, SQR Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2484"></span>2484</td>
<td class="instruction">DEFB $05</td>
<td class="comment-1" rowspan="1"><a href="31AF.html">division</a>: Z, 2/SQR Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2485"></span>2485</td>
<td class="instruction">DEFB $E5</td>
<td class="comment-1" rowspan="1"><a href="340F.html">get_mem_5</a>: Z, 2/SQR Z, G</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2486"></span>2486</td>
<td class="instruction">DEFB $01</td>
<td class="comment-1" rowspan="1"><a href="343C.html">exchange</a>: Z, G, 2/SQR Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2487"></span>2487</td>
<td class="instruction">DEFB $05</td>
<td class="comment-1" rowspan="1"><a href="31AF.html">division</a>: Z, G*SQR Z/2</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2488"></span>2488</td>
<td class="instruction">DEFB $2A</td>
<td class="comment-1" rowspan="1"><a href="346A.html">abs</a>: Z, G'*SQR Z/2 (G'=ABS G)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2489"></span>2489</td>
<td class="instruction">DEFB $38</td>
<td class="comment-1" rowspan="1"><a href="369B.html">end_calc</a>: Z, G'*SQR Z/2=A1, say</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="248A"></span>248A</td>
<td class="instruction">CALL <a href="2DD5.html">FP_TO_A</a></td>
<td class="comment-1" rowspan="1">A1 to <span class="register">A</span> from the stack, if possible.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="248D"></span>248D</td>
<td class="instruction">JR C,<a href="247D.html#2495">USE_252</a></td>
<td class="comment-1" rowspan="1">If A1 rounds to 256 or more, use 252.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="248F"></span>248F</td>
<td class="instruction">AND $FC</td>
<td class="comment-1" rowspan="1">4*INT (A1/4) to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2491"></span>2491</td>
<td class="instruction">ADD A,$04</td>
<td class="comment-1" rowspan="1">Add 4, giving the arc-count A.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2493"></span>2493</td>
<td class="instruction">JR NC,<a href="247D.html#2497">DRAW_SAVE</a></td>
<td class="comment-1" rowspan="1">Jump if still under 256.</td>
</tr>
<tr>
<td class="asm-label">USE_252</td>
<td class="address-2"><span id="2495"></span>2495</td>
<td class="instruction">LD A,$FC</td>
<td class="comment-1" rowspan="1">Here, just use 252.</td>
</tr>
<tr>
<td class="asm-label">DRAW_SAVE</td>
<td class="address-2"><span id="2497"></span>2497</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Now save the arc-count.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2498"></span>2498</td>
<td class="instruction">CALL <a href="2D28.html">STACK_A</a></td>
<td class="comment-1" rowspan="1">Copy it to calculator stack too.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="249B"></span>249B</td>
<td class="instruction">RST <a href="0028.html">$28</a></td>
<td class="comment-1" rowspan="1">Z, A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="249C"></span>249C</td>
<td class="instruction">DEFB $E5</td>
<td class="comment-1" rowspan="1"><a href="340F.html">get_mem_5</a>: Z, A, G</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="249D"></span>249D</td>
<td class="instruction">DEFB $01</td>
<td class="comment-1" rowspan="1"><a href="343C.html">exchange</a>: Z, G, A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="249E"></span>249E</td>
<td class="instruction">DEFB $05</td>
<td class="comment-1" rowspan="1"><a href="31AF.html">division</a>: Z, G/A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="249F"></span>249F</td>
<td class="instruction">DEFB $31</td>
<td class="comment-1" rowspan="1"><a href="33C0.html">duplicate</a>: Z, G/A, G/A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24A0"></span>24A0</td>
<td class="instruction">DEFB $1F</td>
<td class="comment-1" rowspan="1"><a href="37B5.html">sin</a>: Z, G/A, SIN (G/A)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24A1"></span>24A1</td>
<td class="instruction">DEFB $C4</td>
<td class="comment-1" rowspan="1"><a href="342D.html">st_mem_4</a>: (SIN (G/A) is copied to mem-4)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24A2"></span>24A2</td>
<td class="instruction">DEFB $02</td>
<td class="comment-1" rowspan="1"><a href="335B.html#33A1">delete</a>: Z, G/A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24A3"></span>24A3</td>
<td class="instruction">DEFB $31</td>
<td class="comment-1" rowspan="1"><a href="33C0.html">duplicate</a>: Z, G/A, G/A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24A4"></span>24A4</td>
<td class="instruction">DEFB $A2</td>
<td class="comment-1" rowspan="1"><a href="341B.html">stk_half</a>: Z, G/A, G/A, 0.5</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24A5"></span>24A5</td>
<td class="instruction">DEFB $04</td>
<td class="comment-1" rowspan="1"><a href="30CA.html">multiply</a>: Z, G/A, G/2*A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24A6"></span>24A6</td>
<td class="instruction">DEFB $1F</td>
<td class="comment-1" rowspan="1"><a href="37B5.html">sin</a>: Z, G/A, SIN (G/2*A)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24A7"></span>24A7</td>
<td class="instruction">DEFB $C1</td>
<td class="comment-1" rowspan="1"><a href="342D.html">st_mem_1</a>: (SIN (G/2*A) is copied to mem-1)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24A8"></span>24A8</td>
<td class="instruction">DEFB $01</td>
<td class="comment-1" rowspan="1"><a href="343C.html">exchange</a>: Z, SIN (G/2*A), G/A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24A9"></span>24A9</td>
<td class="instruction">DEFB $C0</td>
<td class="comment-1" rowspan="1"><a href="342D.html">st_mem_0</a>: (G/A is copied to mem-0)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24AA"></span>24AA</td>
<td class="instruction">DEFB $02</td>
<td class="comment-1" rowspan="1"><a href="335B.html#33A1">delete</a>: Z, SIN (G/2*A)=S</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24AB"></span>24AB</td>
<td class="instruction">DEFB $31</td>
<td class="comment-1" rowspan="1"><a href="33C0.html">duplicate</a>: Z, S, S</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24AC"></span>24AC</td>
<td class="instruction">DEFB $04</td>
<td class="comment-1" rowspan="1"><a href="30CA.html">multiply</a>: Z, S*S</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24AD"></span>24AD</td>
<td class="instruction">DEFB $31</td>
<td class="comment-1" rowspan="1"><a href="33C0.html">duplicate</a>: Z, S*S, S*S</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24AE"></span>24AE</td>
<td class="instruction">DEFB $0F</td>
<td class="comment-1" rowspan="1"><a href="3014.html">addition</a>: Z, 2*S*S</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24AF"></span>24AF</td>
<td class="instruction">DEFB $A1</td>
<td class="comment-1" rowspan="1"><a href="341B.html">stk_one</a>: Z, 2*S*S, 1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24B0"></span>24B0</td>
<td class="instruction">DEFB $03</td>
<td class="comment-1" rowspan="1"><a href="300F.html">subtract</a>: Z, 2*S*S-1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24B1"></span>24B1</td>
<td class="instruction">DEFB $1B</td>
<td class="comment-1" rowspan="1"><a href="346E.html">negate</a>: Z, 1-2*S*S=COS (G/A)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24B2"></span>24B2</td>
<td class="instruction">DEFB $C3</td>
<td class="comment-1" rowspan="1"><a href="342D.html">st_mem_3</a>: (COS (G/A) is copied to mem-3)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24B3"></span>24B3</td>
<td class="instruction">DEFB $02</td>
<td class="comment-1" rowspan="1"><a href="335B.html#33A1">delete</a>: Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24B4"></span>24B4</td>
<td class="instruction">DEFB $38</td>
<td class="comment-1" rowspan="1"><a href="369B.html">end_calc</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24B5"></span>24B5</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the arc-count to <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="24B6"></span>24B6</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Finished.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="2382.html">2382</a>
</td>
<td class="up">Up: <a href="../maps/all.html#247D">Map</a></td>
<td class="next">
Next: <a href="24B7.html">24B7</a>
</td>
</tr>
</table>
<footer>
<div class="release">The Complete Spectrum ROM Disassembly 20200807</div>
<div class="copyright">&#169; 1982 Amstrad. &#169; 1983 Dr Ian Logan &amp; Dr Frank O'Hara. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../dec/asm/9341.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>