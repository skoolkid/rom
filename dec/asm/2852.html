<!DOCTYPE html>
<html>
<head>
<title>Spectrum ROM: Routine at 02852</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Spectrum ROM" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="2819.html">02819</a>
</td>
<td class="up">Up: <a href="../maps/all.html#2852">Map</a></td>
<td class="next">
Next: <a href="3035.html">03035</a>
</td>
</tr>
</table>
<div class="description">02852: THE 'PRINT ANY CHARACTER(S)' SUBROUTINE</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="2777.html">PO_ABLE</a>.
</div>
<div class="paragraph">
Ordinary character codes, token codes and user-defined graphic codes, and graphic codes are dealt with separately.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Character code</td>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Line number</td>
</tr>
<tr>
<td class="register">C</td>
<td class="register-desc">Column number</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Display file address or printer buffer address</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">PO_ANY</td>
<td class="address-2"><span id="2852"></span>02852</td>
<td class="instruction">CP 128</td>
<td class="comment-1" rowspan="2">Jump forward with ordinary character codes.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2854"></span>02854</td>
<td class="instruction">JR C,<a href="2852.html#2917">PO_CHAR</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2856"></span>02856</td>
<td class="instruction">CP 144</td>
<td class="comment-1" rowspan="2">Jump forward with token codes and UDG codes.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2858"></span>02858</td>
<td class="instruction">JR NC,<a href="2852.html#2898">PO_T_UDG</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2860"></span>02860</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Move the graphic code.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2861"></span>02861</td>
<td class="instruction">CALL <a href="2852.html#2872">PO_GR_1</a></td>
<td class="comment-1" rowspan="1">Construct the graphic form.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2864"></span>02864</td>
<td class="instruction">CALL <a href="2819.html">PO_FETCH</a></td>
<td class="comment-1" rowspan="1"><span class="register">HL</span> has been disturbed so 'fetch' again.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2867"></span>02867</td>
<td class="instruction">LD DE,23698</td>
<td class="comment-1" rowspan="1">Make <span class="register">DE</span> point to the start of the graphic form, i.e. <a href="23698.html">MEMBOT</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2870"></span>02870</td>
<td class="instruction">JR <a href="2852.html#2943">PR_ALL</a></td>
<td class="comment-1" rowspan="1">Jump forward to print the graphic character.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="2872"></span>
<div class="comments">
<div class="paragraph">
Graphic characters are constructed in an ad hoc manner in the calculator's memory area, i.e. mem-0 and mem-1.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PO_GR_1</td>
<td class="address-2"><span id="2872"></span>02872</td>
<td class="instruction">LD HL,23698</td>
<td class="comment-1" rowspan="1">This is <a href="23698.html">MEMBOT</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2875"></span>02875</td>
<td class="instruction">CALL <a href="2852.html#2878">PO_GR_2</a></td>
<td class="comment-1" rowspan="1">In effect call the following subroutine twice.</td>
</tr>
<tr>
<td class="asm-label">PO_GR_2</td>
<td class="address-2"><span id="2878"></span>02878</td>
<td class="instruction">RR B</td>
<td class="comment-1" rowspan="2">Determine bit 0 (and later bit 2) of the graphic code.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2880"></span>02880</td>
<td class="instruction">SBC A,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2881"></span>02881</td>
<td class="instruction">AND 15</td>
<td class="comment-1" rowspan="1">The <span class="register">A</span> register will hold 0 or 15 depending on the value of the bit in the code.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2883"></span>02883</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Save the result in <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2884"></span>02884</td>
<td class="instruction">RR B</td>
<td class="comment-1" rowspan="2">Determine bit 1 (and later bit 3) of the graphic code.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2886"></span>02886</td>
<td class="instruction">SBC A,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2887"></span>02887</td>
<td class="instruction">AND 240</td>
<td class="comment-1" rowspan="1">The <span class="register">A</span> register will hold 0 or 240.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2889"></span>02889</td>
<td class="instruction">OR C</td>
<td class="comment-1" rowspan="1">The two results are combined.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2890"></span>02890</td>
<td class="instruction">LD C,4</td>
<td class="comment-1" rowspan="6">The <span class="register">A</span> register holds half the character form and has to be used four times. This is done for the upper half of the character form and then the lower.</td>
</tr>
<tr>
<td class="asm-label">PO_GR_3</td>
<td class="address-2"><span id="2892"></span>02892</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2893"></span>02893</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2894"></span>02894</td>
<td class="instruction">DEC C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2895"></span>02895</td>
<td class="instruction">JR NZ,<a href="2852.html#2892">PO_GR_3</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2897"></span>02897</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="2898"></span>
<div class="comments">
<div class="paragraph">
Token codes and user-defined graphic codes are now separated.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PO_T_UDG</td>
<td class="address-2"><span id="2898"></span>02898</td>
<td class="instruction">SUB 165</td>
<td class="comment-1" rowspan="2">Jump forward with token codes.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2900"></span>02900</td>
<td class="instruction">JR NC,<a href="2852.html#2911">PO_T</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2902"></span>02902</td>
<td class="instruction">ADD A,21</td>
<td class="comment-1" rowspan="1">UDG codes are now 0 to 15.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2904"></span>02904</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Save the current position values on the machine stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2905"></span>02905</td>
<td class="instruction">LD BC,(23675)</td>
<td class="comment-1" rowspan="2">Fetch the base address of the UDG area (from <a href="23675.html">UDG</a>) and jump forward.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2909"></span>02909</td>
<td class="instruction">JR <a href="2852.html#2922">PO_CHAR_2</a></td>
</tr>
<tr>
<td class="asm-label">PO_T</td>
<td class="address-2"><span id="2911"></span>02911</td>
<td class="instruction">CALL <a href="3082.html#3088">PO_TOKENS</a></td>
<td class="comment-1" rowspan="2">Now print the token and return via <a href="2819.html">PO_FETCH</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2914"></span>02914</td>
<td class="instruction">JP <a href="2819.html">PO_FETCH</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="2917"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="2621.html">PO_RIGHT</a>.
</div>
<div class="paragraph">
The required character form is identified.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PO_CHAR</td>
<td class="address-2"><span id="2917"></span>02917</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">The current position is saved.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2918"></span>02918</td>
<td class="instruction">LD BC,(23606)</td>
<td class="comment-1" rowspan="1">The base address of the character area is fetched (<a href="23606.html">CHARS</a>).</td>
</tr>
<tr>
<td class="asm-label">PO_CHAR_2</td>
<td class="address-2"><span id="2922"></span>02922</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">The print address is saved.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2923"></span>02923</td>
<td class="instruction">LD HL,23611</td>
<td class="comment-1" rowspan="1">This is <a href="23611.html">FLAGS</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2926"></span>02926</td>
<td class="instruction">RES 0,(HL)</td>
<td class="comment-1" rowspan="1">Allow for a leading space.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2928"></span>02928</td>
<td class="instruction">CP " "</td>
<td class="comment-1" rowspan="2">Jump forward if the character is not a 'space'.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2930"></span>02930</td>
<td class="instruction">JR NZ,<a href="2852.html#2934">PO_CHAR_3</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2932"></span>02932</td>
<td class="instruction">SET 0,(HL)</td>
<td class="comment-1" rowspan="1">But 'suppress' if it is.</td>
</tr>
<tr>
<td class="asm-label">PO_CHAR_3</td>
<td class="address-2"><span id="2934"></span>02934</td>
<td class="instruction">LD H,0</td>
<td class="comment-1" rowspan="2">Now pass the character code to the <span class="register">HL</span> register pair.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2936"></span>02936</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2937"></span>02937</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-1" rowspan="3">The character code is in effect multiplied by 8.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2938"></span>02938</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2939"></span>02939</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2940"></span>02940</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">The base address of the character form is found.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2941"></span>02941</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="2">The current position is fetched and the base address passed to the <span class="register">DE</span> register pair.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2942"></span>02942</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="2943"></span>
<div class="comments">
<div class="paragraph">
The following subroutine is used to print all '8*8' bit characters. On entry the <span class="register">DE</span> register pair holds the base address of the character form, the <span class="register">HL</span> register the destination address and the <span class="register">BC</span> register pair the current 'line and column' values.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PR_ALL</td>
<td class="address-2"><span id="2943"></span>02943</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1">Fetch the column number.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2944"></span>02944</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Move one column rightwards.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2945"></span>02945</td>
<td class="instruction">LD A,33</td>
<td class="comment-1" rowspan="2">Jump forward unless a new line is indicated.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2947"></span>02947</td>
<td class="instruction">JR NZ,<a href="2852.html#2963">PR_ALL_1</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2949"></span>02949</td>
<td class="instruction">DEC B</td>
<td class="comment-1" rowspan="1">Move down one line.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2950"></span>02950</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Column number is 33.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2951"></span>02951</td>
<td class="instruction">BIT 1,(IY+1)</td>
<td class="comment-1" rowspan="2">Jump forward if handling the screen (bit 1 of <a href="23611.html">FLAGS</a> reset).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2955"></span>02955</td>
<td class="instruction">JR Z,<a href="2852.html#2963">PR_ALL_1</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2957"></span>02957</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="3">Save the base address whilst the printer buffer is emptied.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2958"></span>02958</td>
<td class="instruction">CALL <a href="3789.html">COPY_BUFF</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2961"></span>02961</td>
<td class="instruction">POP DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2962"></span>02962</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1">Copy the new column number.</td>
</tr>
<tr>
<td class="asm-label">PR_ALL_1</td>
<td class="address-2"><span id="2963"></span>02963</td>
<td class="instruction">CP C</td>
<td class="comment-1" rowspan="4">Test whether a new line is being used. If it is see if the display requires to be scrolled.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2964"></span>02964</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2965"></span>02965</td>
<td class="instruction">CALL Z,<a href="3157.html">PO_SCR</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2968"></span>02968</td>
<td class="instruction">POP DE</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="2969"></span>
<div class="comments">
<div class="paragraph">
Now consider the present state of INVERSE and OVER.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2969"></span>02969</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Save the position values and the destination address on the machine stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2970"></span>02970</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2971"></span>02971</td>
<td class="instruction">LD A,(23697)</td>
<td class="comment-1" rowspan="1">Fetch <a href="23697.html">P-FLAG</a> and read bit 0.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2974"></span>02974</td>
<td class="instruction">LD B,255</td>
<td class="comment-1" rowspan="4">Prepare the 'OVER mask' in the <span class="register">B</span> register, i.e. OVER 0=0 and OVER 1=255.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2976"></span>02976</td>
<td class="instruction">RRA</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2977"></span>02977</td>
<td class="instruction">JR C,<a href="2852.html#2980">PR_ALL_2</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2979"></span>02979</td>
<td class="instruction">INC B</td>
</tr>
<tr>
<td class="asm-label">PR_ALL_2</td>
<td class="address-2"><span id="2980"></span>02980</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="4">Read bit 2 of <a href="23697.html">P-FLAG</a> and prepare the 'INVERSE mask' in the <span class="register">C</span> register, i.e. INVERSE 0=0 and INVERSE 1=255.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2981"></span>02981</td>
<td class="instruction">RRA</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2982"></span>02982</td>
<td class="instruction">SBC A,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2983"></span>02983</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2984"></span>02984</td>
<td class="instruction">LD A,8</td>
<td class="comment-1" rowspan="2">Set the <span class="register">A</span> register to hold the 'pixel-line' counter and clear the carry flag.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2986"></span>02986</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2987"></span>02987</td>
<td class="instruction">BIT 1,(IY+1)</td>
<td class="comment-1" rowspan="2">Jump forward if handling the screen (bit 1 of <a href="23611.html">FLAGS</a> reset).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2991"></span>02991</td>
<td class="instruction">JR Z,<a href="2852.html#2998">PR_ALL_3</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2993"></span>02993</td>
<td class="instruction">SET 1,(IY+48)</td>
<td class="comment-1" rowspan="1">Signal 'printer buffer no longer empty' (set bit 1 of <a href="23658.html">FLAGS2</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="2997"></span>02997</td>
<td class="instruction">SCF</td>
<td class="comment-1" rowspan="1">Set the carry flag to show that the printer is being used.</td>
</tr>
<tr>
<td class="asm-label">PR_ALL_3</td>
<td class="address-2"><span id="2998"></span>02998</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Exchange the destination address with the base address before entering the loop.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="2999"></span>
<div class="comments">
<div class="paragraph">
The character can now be printed. Eight passes of the loop are made - one for each 'pixel-line'.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PR_ALL_4</td>
<td class="address-2"><span id="2999"></span>02999</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">The carry flag is set when using the printer. Save this flag in <span class="register">F'</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3000"></span>03000</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Fetch the existing 'pixel-line'.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3001"></span>03001</td>
<td class="instruction">AND B</td>
<td class="comment-1" rowspan="2">Use the 'OVER mask' and then 'XOR' the result with the 'pixel-line' of the character form.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3002"></span>03002</td>
<td class="instruction">XOR (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3003"></span>03003</td>
<td class="instruction">XOR C</td>
<td class="comment-1" rowspan="1">Finally consider the 'INVERSE mask'.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3004"></span>03004</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Enter the result.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3005"></span>03005</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="2">Fetch the printer flag and jump forward if required.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3006"></span>03006</td>
<td class="instruction">JR C,<a href="2852.html#3027">PR_ALL_6</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3008"></span>03008</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Update the destination address.</td>
</tr>
<tr>
<td class="asm-label">PR_ALL_5</td>
<td class="address-2"><span id="3009"></span>03009</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Update the 'pixel-line' address of the character form.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3010"></span>03010</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="2">Decrease the counter and loop back unless it is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3011"></span>03011</td>
<td class="instruction">JR NZ,<a href="2852.html#2999">PR_ALL_4</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="3013"></span>
<div class="comments">
<div class="paragraph">
Once the character has been printed the attribute byte is to be set as required.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3013"></span>03013</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="2">Make the <span class="register">H</span> register hold a correct high-address for the character area.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3014"></span>03014</td>
<td class="instruction">DEC H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3015"></span>03015</td>
<td class="instruction">BIT 1,(IY+1)</td>
<td class="comment-1" rowspan="2">Set the attribute byte only if handling the screen (bit 1 of <a href="23611.html">FLAGS</a> reset).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3019"></span>03019</td>
<td class="instruction">CALL Z,<a href="3035.html">PO_ATTR</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3022"></span>03022</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="2">Restore the original destination address and the position values.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3023"></span>03023</td>
<td class="instruction">POP BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3024"></span>03024</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="3">Decrease the column number and increase the destination address before returning.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3025"></span>03025</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3026"></span>03026</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="3027"></span>
<div class="comments">
<div class="paragraph">
When the printer is being used the destination address has to be updated in increments of 32.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PR_ALL_6</td>
<td class="address-2"><span id="3027"></span>03027</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Save the printer flag again.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3028"></span>03028</td>
<td class="instruction">LD A,32</td>
<td class="comment-1" rowspan="1">The required increment value.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3030"></span>03030</td>
<td class="instruction">ADD A,E</td>
<td class="comment-1" rowspan="2">Add the value and pass the result back to the <span class="register">E</span> register.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3031"></span>03031</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3032"></span>03032</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Fetch the flag.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="3033"></span>03033</td>
<td class="instruction">JR <a href="2852.html#3009">PR_ALL_5</a></td>
<td class="comment-1" rowspan="1">Jump back into the loop.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="2819.html">02819</a>
</td>
<td class="up">Up: <a href="../maps/all.html#2852">Map</a></td>
<td class="next">
Next: <a href="3035.html">03035</a>
</td>
</tr>
</table>
<footer>
<div class="release">The Complete Spectrum ROM Disassembly 20221121</div>
<div class="copyright">&#169; 1982 Amstrad. &#169; 1983 Dr Ian Logan &amp; Dr Frank O'Hara. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/0B24.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>