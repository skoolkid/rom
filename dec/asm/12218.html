<!DOCTYPE html>
<html>
<head>
<title>Spectrum ROM: Routine at 12218</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Spectrum ROM" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="12187.html">12187</a>
</td>
<td class="up">Up: <a href="../maps/all.html#12218">Map</a></td>
<td class="next">
Next: <a href="12253.html">12253</a>
</td>
</tr>
</table>
<div class="description">12218: THE 'FETCH TWO NUMBERS' SUBROUTINE</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="11747.html">PRINT_FP</a>, <a href="12308.html">addition</a>, <a href="12490.html">multiply</a> and <a href="12719.html">division</a>.
</div>
<div class="paragraph">
This subroutine is called by <a href="12308.html">addition</a>, <a href="12490.html">multiply</a> and <a href="12719.html">division</a> to get two numbers from the calculator stack and put them into the registers, including the exchange registers.
</div>
<div class="paragraph">
On entry to the subroutine the <span class="register">HL</span> register pair points to the first byte of the first number (M) and the <span class="register">DE</span> register pair points to the first byte of the second number (N).
</div>
<div class="paragraph">
When the subroutine is called from <a href="12490.html">multiply</a> or <a href="12719.html">division</a> the sign of the result is saved in the second byte of the first number.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Bit 7 holds the sign bit of the result (when called from <a href="12490.html">multiply</a> or <a href="12719.html">division</a>)</td>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Address of the first byte of N</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address of the first byte of M</td>
</tr>
</table>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">H'B'C'CB</td>
<td class="register-desc">The five bytes of M</td>
</tr>
<tr>
<td class="register">L'D'E'DE</td>
<td class="register-desc">The five bytes of N</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">FETCH_TWO</td>
<td class="address-2"><span id="12218"></span>12218</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span> is preserved.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12219"></span>12219</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1"><span class="register">AF</span> is preserved.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="12220"></span>
<div class="comments">
<div class="paragraph">
Call the five bytes of the first number M1, M2, M3, M4 and M5, and the five bytes of the second number N1, N2, N3, N4 and N5.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12220"></span>12220</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1">M1 to <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12221"></span>12221</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12222"></span>12222</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-1" rowspan="1">M2 to <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12223"></span>12223</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Copy the sign of the result to bit 7 of (<span class="register">HL</span>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12224"></span>12224</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12225"></span>12225</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1">M1 to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12226"></span>12226</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1">M3 to <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12227"></span>12227</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Save M2 and M3 on the machine stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12228"></span>12228</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12229"></span>12229</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1">M4 to <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12230"></span>12230</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12231"></span>12231</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-1" rowspan="1">M5 to <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12232"></span>12232</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span> now points to N1.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12233"></span>12233</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="1">M1 to <span class="register">D</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12234"></span>12234</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="1">N1 to <span class="register">E</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12235"></span>12235</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Save M1 and N1 on the machine stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12236"></span>12236</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12237"></span>12237</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-1" rowspan="1">N2 to <span class="register">D</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12238"></span>12238</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12239"></span>12239</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="1">N3 to <span class="register">E</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12240"></span>12240</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Save N2 and N3 on the machine stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12241"></span>12241</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1">Get the exchange registers.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12242"></span>12242</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">N2 to <span class="register">D'</span> and N3 to <span class="register">E'</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12243"></span>12243</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">M1 to <span class="register">H'</span> and N1 to <span class="register">L'</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12244"></span>12244</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">M2 to <span class="register">B'</span> and M3 to <span class="register">C'</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12245"></span>12245</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1">Get the original set of registers.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12246"></span>12246</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12247"></span>12247</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-1" rowspan="1">N4 to <span class="register">D</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12248"></span>12248</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Next.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12249"></span>12249</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="1">N5 to <span class="register">E</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12250"></span>12250</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore the original <span class="register">AF</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12251"></span>12251</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the original <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="12252"></span>12252</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Finished.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<div class="comments">
<div class="paragraph">
Summary:
</div>
<div class="paragraph">
<ul class="">
<li>M1 - M5 are in <span class="register">H'</span>, <span class="register">B'</span>, <span class="register">C'</span>, <span class="register">C</span>, <span class="register">B</span>.</li>
<li>N1 - N5 are in <span class="register">L'</span>, <span class="register">D'</span>, <span class="register">E'</span>, <span class="register">D</span>, <span class="register">E</span>.</li>
<li><span class="register">HL</span> points to the first byte of the first number.</li>
</ul>
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="12187.html">12187</a>
</td>
<td class="up">Up: <a href="../maps/all.html#12218">Map</a></td>
<td class="next">
Next: <a href="12253.html">12253</a>
</td>
</tr>
</table>
<footer>
<div class="release">The Complete Spectrum ROM Disassembly 20221121</div>
<div class="copyright">&#169; 1982 Amstrad. &#169; 1983 Dr Ian Logan &amp; Dr Frank O'Hara. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/2FBA.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>