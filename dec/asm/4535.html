<!DOCTYPE html>
<html>
<head>
<title>Spectrum ROM: Routine at 04535</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Spectrum ROM" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="4519.html">04519</a>
</td>
<td class="up">Up: <a href="../maps/all.html#4535">Map</a></td>
<td class="next">
Next: <a href="4770.html">04770</a>
</td>
</tr>
</table>
<div class="description">04535: THE 'NEW' COMMAND ROUTINE</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
The address of this routine is found in the <a href="6728.html#6824">parameter table</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">NEW</td>
<td class="address-2"><span id="4535"></span>04535</td>
<td class="instruction">DI</td>
<td class="comment-1" rowspan="1">Disable the maskable interrupt.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4536"></span>04536</td>
<td class="instruction">LD A,255</td>
<td class="comment-1" rowspan="1">The NEW flag.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4538"></span>04538</td>
<td class="instruction">LD DE,(23730)</td>
<td class="comment-1" rowspan="1">The existing value of <a href="23730.html">RAMTOP</a> is preserved.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4542"></span>04542</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="5">Load the alternate registers with the following system variables (<a href="23732.html">P-RAMT</a>, <a href="23608.html">RASP</a>, <a href="23609.html">PIP</a>, <a href="23675.html">UDG</a>). All of which will also be preserved.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4543"></span>04543</td>
<td class="instruction">LD BC,(23732)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4547"></span>04547</td>
<td class="instruction">LD DE,(23608)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4551"></span>04551</td>
<td class="instruction">LD HL,(23675)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4554"></span>04554</td>
<td class="instruction">EXX</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4555"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="0.html">START</a>.
</div>
<div class="paragraph">
The main entry point.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">START_NEW</td>
<td class="address-2"><span id="4555"></span>04555</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Save the flag for later.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4556"></span>04556</td>
<td class="instruction">LD A,7</td>
<td class="comment-1" rowspan="2">Make the border white in colour.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4558"></span>04558</td>
<td class="instruction">OUT (254),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4560"></span>04560</td>
<td class="instruction">LD A,63</td>
<td class="comment-1" rowspan="2">Set the I register to hold the value of 63.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4562"></span>04562</td>
<td class="instruction">LD I,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4564"></span>04564</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="6">Wait 24 T states.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4565"></span>04565</td>
<td class="instruction">NOP</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4566"></span>04566</td>
<td class="instruction">NOP</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4567"></span>04567</td>
<td class="instruction">NOP</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4568"></span>04568</td>
<td class="instruction">NOP</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4569"></span>04569</td>
<td class="instruction">NOP</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4570"></span>
<div class="comments">
<div class="paragraph">
Now the memory is checked.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4570"></span>04570</td>
<td class="instruction">LD H,D</td>
<td class="comment-1" rowspan="2">Transfer the value in <span class="register">DE</span> (<a href="0.html">START</a>=65535, <a href="4535.html">NEW</a>=<a href="23730.html">RAMTOP</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4571"></span>04571</td>
<td class="instruction">LD L,E</td>
</tr>
<tr>
<td class="asm-label">RAM_FILL</td>
<td class="address-2"><span id="4572"></span>04572</td>
<td class="instruction">LD (HL),2</td>
<td class="comment-1" rowspan="4">Enter the value of 2 into every location above 16383.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4574"></span>04574</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4575"></span>04575</td>
<td class="instruction">CP H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4576"></span>04576</td>
<td class="instruction">JR NZ,<a href="4535.html#4572">RAM_FILL</a></td>
</tr>
<tr>
<td class="asm-label">RAM_READ</td>
<td class="address-2"><span id="4578"></span>04578</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Prepare for true subtraction.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4579"></span>04579</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-1" rowspan="2">The carry flag will become reset when the top is reached.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4581"></span>04581</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4582"></span>04582</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Update the pointer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4583"></span>04583</td>
<td class="instruction">JR NC,<a href="4535.html#4591">RAM_DONE</a></td>
<td class="comment-1" rowspan="1">Jump when at top.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4585"></span>04585</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">2 goes to 1.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4586"></span>04586</td>
<td class="instruction">JR Z,<a href="4535.html#4591">RAM_DONE</a></td>
<td class="comment-1" rowspan="1">But if zero then RAM is faulty. Use current <span class="register">HL</span> as top.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4588"></span>04588</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">1 goes to 0.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4589"></span>04589</td>
<td class="instruction">JR Z,<a href="4535.html#4578">RAM_READ</a></td>
<td class="comment-1" rowspan="1">Step to the next test unless it fails.</td>
</tr>
<tr>
<td class="asm-label">RAM_DONE</td>
<td class="address-2"><span id="4591"></span>04591</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span> points to the last actual location in working order.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4592"></span>
<div class="comments">
<div class="paragraph">
Next restore the 'preserved' system variables. (Meaningless when coming from <a href="0.html">START</a>.)
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4592"></span>04592</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="5">Restore <a href="23732.html">P-RAMT</a>, <a href="23608.html">RASP</a>, <a href="23609.html">PIP</a> and <a href="23675.html">UDG</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4593"></span>04593</td>
<td class="instruction">LD (23732),BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4597"></span>04597</td>
<td class="instruction">LD (23608),DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4601"></span>04601</td>
<td class="instruction">LD (23675),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4604"></span>04604</td>
<td class="instruction">EXX</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4605"></span>04605</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1">Test the <a href="0.html">START</a>/<a href="4535.html">NEW</a> flag.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4606"></span>04606</td>
<td class="instruction">JR Z,<a href="4535.html#4633">RAM_SET</a></td>
<td class="comment-1" rowspan="1">Jump forward if coming from the <a href="4535.html">NEW</a> command routine.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4608"></span>
<div class="comments">
<div class="paragraph">
Overwrite the system variables when coming from <a href="0.html">START</a> and initialise the user-defined graphics area.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4608"></span>04608</td>
<td class="instruction">LD (23732),HL</td>
<td class="comment-1" rowspan="1">Top of physical RAM (<a href="23732.html">P-RAMT</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4611"></span>04611</td>
<td class="instruction">LD DE,16047</td>
<td class="comment-1" rowspan="1">Last byte of 'U' in character set.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4614"></span>04614</td>
<td class="instruction">LD BC,168</td>
<td class="comment-1" rowspan="1">There are this number of bytes in twenty one letters.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4617"></span>04617</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Switch the pointers.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4618"></span>04618</td>
<td class="instruction">LDDR</td>
<td class="comment-1" rowspan="1">Now copy the character forms of the letters 'A' to 'U'.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4620"></span>04620</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Switch the pointers back.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4621"></span>04621</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point to the first byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4622"></span>04622</td>
<td class="instruction">LD (23675),HL</td>
<td class="comment-1" rowspan="1">Now set <a href="23675.html">UDG</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4625"></span>04625</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Down one location.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4626"></span>04626</td>
<td class="instruction">LD BC,64</td>
<td class="comment-1" rowspan="2">Set the system variables <a href="23608.html">RASP</a> and <a href="23609.html">PIP</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4629"></span>04629</td>
<td class="instruction">LD (23608),BC</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4633"></span>
<div class="comments">
<div class="paragraph">
The remainder of the routine is common to both the <a href="0.html">START</a> and the <a href="4535.html">NEW</a> operations.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">RAM_SET</td>
<td class="address-2"><span id="4633"></span>04633</td>
<td class="instruction">LD (23730),HL</td>
<td class="comment-1" rowspan="1">Set <a href="23730.html">RAMTOP</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4636"></span>04636</td>
<td class="instruction">LD HL,15360</td>
<td class="comment-1" rowspan="2">Initialise the system variable <a href="23606.html">CHARS</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4639"></span>04639</td>
<td class="instruction">LD (23606),HL</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4642"></span>
<div class="comments">
<div class="paragraph">
Next the machine stack is set up.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4642"></span>04642</td>
<td class="instruction">LD HL,(23730)</td>
<td class="comment-1" rowspan="2">The top location (<a href="23730.html">RAMTOP</a>) is made to hold 62.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4645"></span>04645</td>
<td class="instruction">LD (HL),62</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4647"></span>04647</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">The next location is left holding zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4648"></span>04648</td>
<td class="instruction">LD SP,HL</td>
<td class="comment-1" rowspan="1">These two locations represent the 'last entry'.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4649"></span>04649</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="3">Step down two locations to find the correct value for <a href="23613.html">ERR-SP</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4650"></span>04650</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4651"></span>04651</td>
<td class="instruction">LD (23613),HL</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4654"></span>
<div class="comments">
<div class="paragraph">
The initialisation routine continues with:
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4654"></span>04654</td>
<td class="instruction">IM 1</td>
<td class="comment-1" rowspan="1">Interrupt mode 1 is used.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4656"></span>04656</td>
<td class="instruction">LD IY,23610</td>
<td class="comment-1" rowspan="1"><span class="register">IY</span> holds +<a href="23610.html">ERR-NR</a> always.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4660"></span>04660</td>
<td class="instruction">EI</td>
<td class="comment-1" rowspan="1">The maskable interrupt can now be enabled. The real-time clock will be updated and the keyboard scanned every 1/50th of a second.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4661"></span>04661</td>
<td class="instruction">LD HL,23734</td>
<td class="comment-1" rowspan="2">The system variable <a href="23631.html">CHANS</a> is set to the base address of the <a href="23734.html">channel information area</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4664"></span>04664</td>
<td class="instruction">LD (23631),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4667"></span>04667</td>
<td class="instruction">LD DE,5551</td>
<td class="comment-1" rowspan="4">The initial channel data is moved from the table (<a href="5551.html">CHANINFO</a>) to the channel information area.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4670"></span>04670</td>
<td class="instruction">LD BC,21</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4673"></span>04673</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4674"></span>04674</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4676"></span>04676</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="3">The system variable <a href="23639.html">DATADD</a> is made to point to the last location of the channel data.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4677"></span>04677</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4678"></span>04678</td>
<td class="instruction">LD (23639),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4681"></span>04681</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="3">And <a href="23635.html">PROG</a> and <a href="23627.html">VARS</a> to the the location after that.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4682"></span>04682</td>
<td class="instruction">LD (23635),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4685"></span>04685</td>
<td class="instruction">LD (23627),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4688"></span>04688</td>
<td class="instruction">LD (HL),128</td>
<td class="comment-1" rowspan="1">The end-marker of the variables area.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4690"></span>04690</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Move on one location to find the value for <a href="23641.html">E-LINE</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4691"></span>04691</td>
<td class="instruction">LD (23641),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4694"></span>04694</td>
<td class="instruction">LD (HL),13</td>
<td class="comment-1" rowspan="2">Make the edit-line be a single 'carriage return' character.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4696"></span>04696</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4697"></span>04697</td>
<td class="instruction">LD (HL),128</td>
<td class="comment-1" rowspan="1">Now enter an end marker.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4699"></span>04699</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="4">Move on one location to find the value for <a href="23649.html">WORKSP</a>, <a href="23651.html">STKBOT</a> and <a href="23653.html">STKEND</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4700"></span>04700</td>
<td class="instruction">LD (23649),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4703"></span>04703</td>
<td class="instruction">LD (23651),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4706"></span>04706</td>
<td class="instruction">LD (23653),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4709"></span>04709</td>
<td class="instruction">LD A,56</td>
<td class="comment-1" rowspan="4">Initialise the colour system variables (<a href="23693.html">ATTR-P</a>, <a href="23695.html">ATTR-T</a>, <a href="23624.html">BORDCR</a>) to FLASH 0, BRIGHT 0, PAPER 7, INK 0, BORDER 7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4711"></span>04711</td>
<td class="instruction">LD (23693),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4714"></span>04714</td>
<td class="instruction">LD (23695),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4717"></span>04717</td>
<td class="instruction">LD (23624),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4720"></span>04720</td>
<td class="instruction">LD HL,1315</td>
<td class="comment-1" rowspan="2">Initialise the system variables <a href="23561.html">REPDEL</a> and <a href="23562.html">REPPER</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4723"></span>04723</td>
<td class="instruction">LD (23561),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4726"></span>04726</td>
<td class="instruction">DEC (IY-58)</td>
<td class="comment-1" rowspan="1">Make <a href="23552.html">KSTATE0</a> hold 255.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4729"></span>04729</td>
<td class="instruction">DEC (IY-54)</td>
<td class="comment-1" rowspan="1">Make <a href="23552.html#23556">KSTATE4</a> hold 255.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4732"></span>04732</td>
<td class="instruction">LD HL,5574</td>
<td class="comment-1" rowspan="4">Next move the <a href="5574.html">initial stream data</a> from its table to the <a href="23568.html">streams area</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4735"></span>04735</td>
<td class="instruction">LD DE,23568</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4738"></span>04738</td>
<td class="instruction">LD BC,14</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4741"></span>04741</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4743"></span>04743</td>
<td class="instruction">SET 1,(IY+1)</td>
<td class="comment-1" rowspan="2">Signal 'printer in use' (set bit 1 of <a href="23611.html">FLAGS</a>) and clear the printer buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4747"></span>04747</td>
<td class="instruction">CALL <a href="3807.html">CLEAR_PRB</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4750"></span>04750</td>
<td class="instruction">LD (IY+49),2</td>
<td class="comment-1" rowspan="2">Set the size of the lower part of the display (<a href="23659.html">DF-SZ</a>) and clear the whole display.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4754"></span>04754</td>
<td class="instruction">CALL <a href="3435.html">CLS</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4757"></span>04757</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="3">Now print the message '&#169; 1982 Sinclair Research Ltd' on the bottom line.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4758"></span>04758</td>
<td class="instruction">LD DE,5432</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4761"></span>04761</td>
<td class="instruction">CALL <a href="3082.html">PO_MSG</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4764"></span>04764</td>
<td class="instruction">SET 5,(IY+2)</td>
<td class="comment-1" rowspan="1">Signal 'the lower part will required to be cleared' (set bit 5 of <a href="23612.html">TV-FLAG</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="4768"></span>04768</td>
<td class="instruction">JR <a href="4770.html#4777">MAIN_1</a></td>
<td class="comment-1" rowspan="1">Jump forward into the main execution loop.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="4519.html">04519</a>
</td>
<td class="up">Up: <a href="../maps/all.html#4535">Map</a></td>
<td class="next">
Next: <a href="4770.html">04770</a>
</td>
</tr>
</table>
<footer>
<div class="release">The Complete Spectrum ROM Disassembly 20200807</div>
<div class="copyright">&#169; 1982 Amstrad. &#169; 1983 Dr Ian Logan &amp; Dr Frank O'Hara. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../asm/11B7.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>