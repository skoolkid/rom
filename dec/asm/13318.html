<!DOCTYPE html>
<html>
<head>
<title>Spectrum ROM: Routine at 13318</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Spectrum ROM" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="13303.html">13303</a>
</td>
<td class="up">Up: <a href="../maps/all.html#13318">Map</a></td>
<td class="next">
Next: <a href="13327.html">13327</a>
</td>
</tr>
</table>
<div class="description">13318: THE 'MEMORY LOCATION' SUBROUTINE</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="1016.html">BEEP</a>, <a href="13327.html">get_mem</a> and <a href="13357.html">st_mem</a>.
</div>
<div class="paragraph">
This subroutine finds the base address for each five-byte portion of the calculator's memory area to or from which a floating-point number is to be moved from or to the calculator stack. It does this operation by adding five times the parameter supplied to the base address for the area which is held in the <span class="register">HL</span> register pair.
</div>
<div class="paragraph">
Note that when a FOR-NEXT variable is being handled then the pointers are changed so that the variable is treated as if it were the calculator's memory area.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Index of the required entry</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Base address (<a href="1134.html">SEMITONES</a> or <a href="23656.html">MEM</a>)</td>
</tr>
</table>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Base address + 5 * <span class="register">A</span></td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">LOC_MEM</td>
<td class="address-2"><span id="13318"></span>13318</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Copy the parameter to <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13319"></span>13319</td>
<td class="instruction">RLCA</td>
<td class="comment-1" rowspan="1">Double the parameter.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13320"></span>13320</td>
<td class="instruction">RLCA</td>
<td class="comment-1" rowspan="1">Double the result.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13321"></span>13321</td>
<td class="instruction">ADD A,C</td>
<td class="comment-1" rowspan="1">Add the value of the parameter to give five times the original value.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13322"></span>13322</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="2">This result is wanted in the <span class="register">BC</span> register pair.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13323"></span>13323</td>
<td class="instruction">LD B,0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13325"></span>13325</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Produce the new base address.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13326"></span>13326</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Finished.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="13303.html">13303</a>
</td>
<td class="up">Up: <a href="../maps/all.html#13318">Map</a></td>
<td class="next">
Next: <a href="13327.html">13327</a>
</td>
</tr>
</table>
<footer>
<div class="release">The Complete Spectrum ROM Disassembly 20200807</div>
<div class="copyright">&#169; 1982 Amstrad. &#169; 1983 Dr Ian Logan &amp; Dr Frank O'Hara. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../asm/3406.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>