<!DOCTYPE html>
<html>
<head>
<title>Spectrum ROM: Routine at 04770</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Spectrum ROM" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="4535.html">04535</a></span></td>
<td class="up">Up: <a href="../maps/all.html#4770">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="5009.html">05009</a></span></td>
</tr>
</table>
<div class="description">04770: THE 'MAIN EXECUTION' LOOP</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="5469.html">MAIN_ADD</a>.
</div>
<div class="paragraph">
The main loop controls the 'editing mode', the execution of direct commands and the production of reports.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_EXEC</td>
<td class="address-2"><span id="4770"></span>04770</td>
<td class="bytes-0"></td>
<td class="instruction">LD (IY+49),2</td>
<td class="comment-11" rowspan="1">The lower part of the screen is to be two lines in size (see <a href="23659.html">DF-SZ</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4774"></span>04774</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="6037.html">AUTO_LIST</a></td>
<td class="comment-11" rowspan="1">Produce an automatic listing.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4777"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="4535.html">NEW</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_1</td>
<td class="address-2"><span id="4777"></span>04777</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="5808.html">SET_MIN</a></td>
<td class="comment-11" rowspan="1">All the areas from <a href="23641.html">E-LINE</a> onwards are given their minimum configurations.</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_2</td>
<td class="address-2"><span id="4780"></span>04780</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,0</td>
<td class="comment-11" rowspan="2">Channel 'K' is opened before calling the <a href="3884.html">EDITOR</a>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4782"></span>04782</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="5633.html">CHAN_OPEN</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4785"></span>04785</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="3884.html">EDITOR</a></td>
<td class="comment-11" rowspan="1">The <a href="3884.html">EDITOR</a> is called to allow the user to build up a BASIC line.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4788"></span>04788</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="6935.html">LINE_SCAN</a></td>
<td class="comment-11" rowspan="1">The current line is scanned for correct syntax.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4791"></span>04791</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 7,(IY+0)</td>
<td class="comment-11" rowspan="2">Jump forward if the syntax is correct (<a href="23610.html">ERR-NR</a> is 255).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4795"></span>04795</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,<a href="4770.html#4815">MAIN_3</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4797"></span>04797</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 4,(IY+48)</td>
<td class="comment-11" rowspan="2">Jump forward if other than channel 'K' is being used (bit 4 of <a href="23658.html">FLAGS2</a> is set).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4801"></span>04801</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="4770.html#4867">MAIN_4</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4803"></span>04803</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,(23641)</td>
<td class="comment-11" rowspan="1">Point to the start of the line with the error (<a href="23641.html">E-LINE</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4806"></span>04806</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="4519.html">REMOVE_FP</a></td>
<td class="comment-11" rowspan="1">Remove the floating-point forms from this line.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4809"></span>04809</td>
<td class="bytes-0"></td>
<td class="instruction">LD (IY+0),255</td>
<td class="comment-11" rowspan="2">Reset <a href="23610.html">ERR-NR</a> and jump back to <a href="4770.html#4780">MAIN_2</a> leaving the listing unchanged.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4813"></span>04813</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="4770.html#4780">MAIN_2</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4815"></span>
<div class="comments">
<div class="paragraph">
The 'edit-line' has passed syntax and the three types of line that are possible have to be distinguished from each other.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_3</td>
<td class="address-2"><span id="4815"></span>04815</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,(23641)</td>
<td class="comment-11" rowspan="1">Point to the start of the line (<a href="23641.html">E-LINE</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4818"></span>04818</td>
<td class="bytes-0"></td>
<td class="instruction">LD (23645),HL</td>
<td class="comment-11" rowspan="1">Set <a href="23645.html">CH-ADD</a> to the start also.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4821"></span>04821</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="6651.html">E_LINE_NO</a></td>
<td class="comment-11" rowspan="1">Fetch any line number into <span class="register">BC</span>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4824"></span>04824</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="2">Is the line number a valid one?</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4825"></span>04825</td>
<td class="bytes-0"></td>
<td class="instruction">OR C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4826"></span>04826</td>
<td class="bytes-0"></td>
<td class="instruction">JP NZ,<a href="5469.html">MAIN_ADD</a></td>
<td class="comment-11" rowspan="1">Jump if it is so, and add the new line to the existing program.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4829"></span>04829</td>
<td class="bytes-0"></td>
<td class="instruction">RST <a href="24.html">24</a></td>
<td class="comment-11" rowspan="2">Fetch the first character of the line and see if the line is 'carriage return only'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4830"></span>04830</td>
<td class="bytes-0"></td>
<td class="instruction">CP 13</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4832"></span>04832</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="4770.html#4770">MAIN_EXEC</a></td>
<td class="comment-11" rowspan="1">If it is then jump back.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4834"></span>
<div class="comments">
<div class="paragraph">
The 'edit-line' must start with a direct BASIC command so this line becomes the first line to be interpreted.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4834"></span>04834</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 0,(IY+48)</td>
<td class="comment-11" rowspan="2">Clear the whole display unless the flag (bit 0 of <a href="23658.html">FLAGS2</a>) says it is unnecessary.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4838"></span>04838</td>
<td class="bytes-0"></td>
<td class="instruction">CALL NZ,<a href="3503.html">CL_ALL</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4841"></span>04841</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="3435.html#3438">CLS_LOWER</a></td>
<td class="comment-11" rowspan="1">Clear the lower part anyway.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4844"></span>04844</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,25</td>
<td class="comment-11" rowspan="3">Set the appropriate value for the scroll counter (<a href="23692.html">SCR-CT</a>) by subtracting the second byte of <a href="23688.html">S-POSN</a> from 25).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4846"></span>04846</td>
<td class="bytes-0"></td>
<td class="instruction">SUB (IY+79)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4849"></span>04849</td>
<td class="bytes-0"></td>
<td class="instruction">LD (23692),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4852"></span>04852</td>
<td class="bytes-0"></td>
<td class="instruction">SET 7,(IY+1)</td>
<td class="comment-11" rowspan="1">Signal 'line execution' (set bit 7 of <a href="23611.html">FLAGS</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4856"></span>04856</td>
<td class="bytes-0"></td>
<td class="instruction">LD (IY+0),255</td>
<td class="comment-11" rowspan="1">Ensure <a href="23610.html">ERR-NR</a> is correct.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4860"></span>04860</td>
<td class="bytes-0"></td>
<td class="instruction">LD (IY+10),1</td>
<td class="comment-11" rowspan="1">Deal with the first statement in the line (set <a href="23620.html">NSPPC</a> to 1).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4864"></span>04864</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="7050.html">LINE_RUN</a></td>
<td class="comment-11" rowspan="1">Now the line is interpreted. Note: the address <a href="4770.html#4867">MAIN_4</a> goes on to the machine stack and is addressed by <a href="23613.html">ERR-SP</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4867"></span>
<div class="comments">
<div class="paragraph">
After the line has been interpreted and all the actions consequential to it have been completed a return is made to <a href="4770.html#4867">MAIN_4</a>, so that a report can be made.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_4</td>
<td class="address-2"><span id="4867"></span>04867</td>
<td class="bytes-0"></td>
<td class="instruction">HALT</td>
<td class="comment-11" rowspan="1">The maskable interrupt must be enabled.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4868"></span>04868</td>
<td class="bytes-0"></td>
<td class="instruction">RES 5,(IY+1)</td>
<td class="comment-11" rowspan="1">Signal 'ready for a new key' (reset bit 5 of <a href="23611.html">FLAGS</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4872"></span>04872</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 1,(IY+48)</td>
<td class="comment-11" rowspan="2">Empty the printer buffer if it has been used (bit 1 of <a href="23658.html">FLAGS2</a> set).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4876"></span>04876</td>
<td class="bytes-0"></td>
<td class="instruction">CALL NZ,<a href="3789.html">COPY_BUFF</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4879"></span>04879</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(23610)</td>
<td class="comment-11" rowspan="2">Fetch the error number (<a href="23610.html">ERR-NR</a>) and increment it.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4882"></span>04882</td>
<td class="bytes-0"></td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="4883"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="5461.html">REPORT_G</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_G</td>
<td class="address-2"><span id="4883"></span>04883</td>
<td class="bytes-0"></td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">Save the new value.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4884"></span>04884</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,0</td>
<td class="comment-11" rowspan="4">The system variables <a href="23665.html">FLAGX</a>, <a href="23647.html">X-PTR-hi</a> and <a href="23563.html">DEFADD</a> are all set to zero.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4887"></span>04887</td>
<td class="bytes-0"></td>
<td class="instruction">LD (IY+55),H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4890"></span>04890</td>
<td class="bytes-0"></td>
<td class="instruction">LD (IY+38),H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4893"></span>04893</td>
<td class="bytes-0"></td>
<td class="instruction">LD (23563),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4896"></span>04896</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,1</td>
<td class="comment-11" rowspan="2">Ensure that stream 0 points to channel 'K' (see <a href="23568.html">STRMS</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4899"></span>04899</td>
<td class="bytes-0"></td>
<td class="instruction">LD (23574),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4902"></span>04902</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="5808.html">SET_MIN</a></td>
<td class="comment-11" rowspan="1">Clear all the work areas and the calculator stack.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4905"></span>04905</td>
<td class="bytes-0"></td>
<td class="instruction">RES 5,(IY+55)</td>
<td class="comment-11" rowspan="1">Signal 'editing mode' (reset bit 5 of <a href="23665.html">FLAGX</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4909"></span>04909</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="3435.html#3438">CLS_LOWER</a></td>
<td class="comment-11" rowspan="1">Clear the lower screen.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4912"></span>04912</td>
<td class="bytes-0"></td>
<td class="instruction">SET 5,(IY+2)</td>
<td class="comment-11" rowspan="1">Signal 'the lower screen will require clearing' (set bit 5 of <a href="23612.html">TV-FLAG</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4916"></span>04916</td>
<td class="bytes-0"></td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1">Fetch the report value.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4917"></span>04917</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">Make a copy in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4918"></span>04918</td>
<td class="bytes-0"></td>
<td class="instruction">CP 10</td>
<td class="comment-11" rowspan="2">Jump forward with report numbers '0 to 9'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4920"></span>04920</td>
<td class="bytes-0"></td>
<td class="instruction">JR C,<a href="4770.html#4924">MAIN_5</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4922"></span>04922</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,7</td>
<td class="comment-11" rowspan="1">Add the ASCII letter offset value.</td>
</tr>
<tr>
<td class="asm-label-1">MAIN_5</td>
<td class="address-2"><span id="4924"></span>04924</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="5615.html">OUT_CODE</a></td>
<td class="comment-11" rowspan="3">Print the report code and follow it with a 'space'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4927"></span>04927</td>
<td class="bytes-0"></td>
<td class="instruction">LD A," "</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4929"></span>04929</td>
<td class="bytes-0"></td>
<td class="instruction">RST <a href="16.html">16</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4930"></span>04930</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1">Fetch the report value (used to identify the required report message).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4931"></span>04931</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,5009</td>
<td class="comment-11" rowspan="2">Print the message.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4934"></span>04934</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="3082.html">PO_MSG</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4937"></span>04937</td>
<td class="bytes-0"></td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="3">Follow it by a 'comma' and a 'space'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4938"></span>04938</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,5430</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4941"></span>04941</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="3082.html">PO_MSG</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4944"></span>04944</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,(23621)</td>
<td class="comment-11" rowspan="2">Now fetch the current line number (<a href="23621.html">PPC</a>) and print it as well.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4948"></span>04948</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="6683.html">OUT_NUM_1</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4951"></span>04951</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,":"</td>
<td class="comment-11" rowspan="2">Follow it by a ':'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4953"></span>04953</td>
<td class="bytes-0"></td>
<td class="instruction">RST <a href="16.html">16</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4954"></span>04954</td>
<td class="bytes-0"></td>
<td class="instruction">LD C,(IY+13)</td>
<td class="comment-11" rowspan="3">Fetch the current statement number (<a href="23623.html">SUBPPC</a>) into the <span class="register">BC</span> register pair and print it.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4957"></span>04957</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4959"></span>04959</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="6683.html">OUT_NUM_1</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4962"></span>04962</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="4247.html">CLEAR_SP</a></td>
<td class="comment-11" rowspan="1">Clear the editing area.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4965"></span>04965</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(23610)</td>
<td class="comment-11" rowspan="1">Fetch the error number (<a href="23610.html">ERR-NR</a>) again.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4968"></span>04968</td>
<td class="bytes-0"></td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">Increment it as usual.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4969"></span>04969</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="4770.html#4998">MAIN_9</a></td>
<td class="comment-11" rowspan="1">If the program was completed successfully there cannot be any 'CONTinuing' so jump.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4971"></span>04971</td>
<td class="bytes-0"></td>
<td class="instruction">CP 9</td>
<td class="comment-11" rowspan="5">If the program halted with 'STOP statement' or 'BREAK into program' CONTinuing will be from the next statement; otherwise <a href="23623.html">SUBPPC</a> is unchanged.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4973"></span>04973</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="4770.html#4979">MAIN_6</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4975"></span>04975</td>
<td class="bytes-0"></td>
<td class="instruction">CP 21</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4977"></span>04977</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,<a href="4770.html#4982">MAIN_7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1">MAIN_6</td>
<td class="address-2"><span id="4979"></span>04979</td>
<td class="bytes-0"></td>
<td class="instruction">INC (IY+13)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1">MAIN_7</td>
<td class="address-2"><span id="4982"></span>04982</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,3</td>
<td class="comment-11" rowspan="2">The system variables <a href="23662.html">OLDPPC</a> and <a href="23664.html">OSPCC</a> have now to be made to hold the CONTinuing line and statement numbers.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4985"></span>04985</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,23664</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4988"></span>04988</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,23620</td>
<td class="comment-11" rowspan="5">The values used will be those in <a href="23621.html">PPC</a> and <a href="23623.html">SUBPPC</a> unless <a href="23620.html">NSPPC</a> indicates that the 'break' occurred before a 'jump' (i.e. after a GO TO statement etc.).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4991"></span>04991</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4993"></span>04993</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="4770.html#4996">MAIN_8</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="4995"></span>04995</td>
<td class="bytes-0"></td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1">MAIN_8</td>
<td class="address-2"><span id="4996"></span>04996</td>
<td class="bytes-0"></td>
<td class="instruction">LDDR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1">MAIN_9</td>
<td class="address-2"><span id="4998"></span>04998</td>
<td class="bytes-0"></td>
<td class="instruction">LD (IY+10),255</td>
<td class="comment-11" rowspan="1"><a href="23620.html">NSPPC</a> is reset to indicate 'no jump'.</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="5002"></span>05002</td>
<td class="bytes-0"></td>
<td class="instruction">RES 3,(IY+1)</td>
<td class="comment-11" rowspan="1">'K mode' is selected (reset bit 3 of <a href="23611.html">FLAGS</a>).</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="5006"></span>05006</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="4770.html#4780">MAIN_2</a></td>
<td class="comment-11" rowspan="1">And finally the jump back is made but no program listing will appear until requested.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="4535.html">04535</a></span></td>
<td class="up">Up: <a href="../maps/all.html#4770">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="5009.html">05009</a></span></td>
</tr>
</table>
<footer>
<div class="release">The Complete Spectrum ROM Disassembly 20190603</div>
<div class="copyright">&#169; 1982 Amstrad. &#169; 1983 Dr Ian Logan &amp; Dr Frank O'Hara. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/12A2.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>