<!DOCTYPE html>
<html>
<head>
<title>Spectrum ROM: Routine at 13545</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Spectrum ROM" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="13500.html">13500</a>
</td>
<td class="up">Up: <a href="../maps/all.html#13545">Map</a></td>
<td class="next">
Next: <a href="13561.html">13561</a>
</td>
</tr>
</table>
<div class="description">13545: THE 'TEST-ZERO' SUBROUTINE</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="7408.html">IF_CMD</a>, <a href="12480.html">PREP_M_D</a>, <a href="13422.html">negate</a>, <a href="13458.html">sgn</a>, <a href="13561.html">greater_0</a>, <a href="13569.html">f_not</a>, <a href="13595.html">no_or_no</a>, <a href="13604.html">no_and_no</a> and <a href="13613.html">str_no</a>.
</div>
<div class="paragraph">
This subroutine is called at least nine times to test whether a floating-point number is zero. This test requires that the first four bytes of the number should each be zero. The subroutine returns with the carry flag set if the number was in fact zero.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address of the first byte of the number</td>
</tr>
</table>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">F</td>
<td class="register-desc">Carry flag set if the number is zero</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">TEST_ZERO</td>
<td class="address-2"><span id="13545"></span>13545</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Save <span class="register">HL</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13546"></span>13546</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Save <span class="register">BC</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13547"></span>13547</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Save the value of <span class="register">A</span> in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13548"></span>13548</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the first byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13549"></span>13549</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point to the second byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13550"></span>13550</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">'OR' the first byte with the second.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13551"></span>13551</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point to the third byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13552"></span>13552</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">'OR' the result with the third byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13553"></span>13553</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point to the fourth byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13554"></span>13554</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">'OR' the result with the fourth byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13555"></span>13555</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1">Restore the original value of <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13556"></span>13556</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">And of <span class="register">BC</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13557"></span>13557</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the pointer to the number to <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13558"></span>13558</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return with carry reset if any of the four bytes was non-zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13559"></span>13559</td>
<td class="instruction">SCF</td>
<td class="comment-1" rowspan="2">Set the carry flag to indicate that the number was zero, and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="13560"></span>13560</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="13500.html">13500</a>
</td>
<td class="up">Up: <a href="../maps/all.html#13545">Map</a></td>
<td class="next">
Next: <a href="13561.html">13561</a>
</td>
</tr>
</table>
<footer>
<div class="release">The Complete Spectrum ROM Disassembly 20221121</div>
<div class="copyright">&#169; 1982 Amstrad. &#169; 1983 Dr Ian Logan &amp; Dr Frank O'Hara. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/34E9.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>